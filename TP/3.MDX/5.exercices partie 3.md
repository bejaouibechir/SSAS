# Atelier MDX - Exercices Pratiques (Partie 3)

# PARTIE 3 : TIME INTELLIGENCE

## Exercice 31 : Year-To-Date (YTD)

### ğŸ“ Objectif

Calculer un cumul depuis le dÃ©but de l'annÃ©e.

### ğŸ“ Ã‰noncÃ©

Affichez le montant des ventes YTD pour chaque mois de l'annÃ©e 2013.

### ğŸ’¡ Indice

Utilisez la fonction `Ytd()` avec le membre courant.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[YTD Sales] AS
  Aggregate(
    Ytd([Dim Date].[Calendar Hierarchy].CurrentMember),
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[YTD Sales]
  } ON COLUMNS,
  Descendants(
    [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013],
    [Dim Date].[Calendar Hierarchy].[Month]
  ) ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `Ytd(member)` : Retourne tous les membres depuis le dÃ©but de l'annÃ©e jusqu'au membre spÃ©cifiÃ©
- `Aggregate()` : Somme tous les membres du set
- RÃ©sultat : Janvier = Jan, FÃ©vrier = Jan+FÃ©v, Mars = Jan+FÃ©v+Mars, etc.

---

## Exercice 32 : Quarter-To-Date (QTD)

### ğŸ“ Objectif

Calculer un cumul depuis le dÃ©but du trimestre.

### ğŸ“ Ã‰noncÃ©

Affichez le montant des ventes QTD pour chaque mois du Q2 2013.

### ğŸ’¡ Indice

Utilisez la fonction `Qtd()`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[QTD Sales] AS
  Aggregate(
    Qtd([Dim Date].[Calendar Hierarchy].CurrentMember),
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[QTD Sales]
  } ON COLUMNS,
  Descendants(
    [Dim Date].[Calendar Hierarchy].[Calendar Quarter].&[2013]&[2],
    [Dim Date].[Calendar Hierarchy].[Month]
  ) ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `Qtd(member)` : Retourne tous les membres depuis le dÃ©but du trimestre
- Avril (Q2) = Avril, Mai (Q2) = Avril+Mai, Juin (Q2) = Avril+Mai+Juin

---

## Exercice 33 : Month-To-Date (MTD)

### ğŸ“ Objectif

Calculer un cumul depuis le dÃ©but du mois.

### ğŸ“ Ã‰noncÃ©

CrÃ©ez une mesure MTD pour les ventes.

### ğŸ’¡ Indice

Utilisez `Mtd()`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[MTD Sales] AS
  Aggregate(
    Mtd([Dim Date].[Calendar Hierarchy].CurrentMember),
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[MTD Sales]
  } ON COLUMNS,
  [Dim Date].[Calendar Hierarchy].[Month].MEMBERS ON ROWS
FROM [Adventure Works]
WHERE [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013]
```

### ğŸ“Š Explication

- `Mtd(member)` : Membres depuis le dÃ©but du mois
- Au niveau mois, MTD = mÃªme valeur que la mesure de base
- Plus utile au niveau jour ou semaine

---

## Exercice 34 : PeriodsToDate() personnalisÃ©

### ğŸ“ Objectif

CrÃ©er un cumul personnalisÃ© jusqu'Ã  un niveau spÃ©cifique.

### ğŸ“ Ã‰noncÃ©

CrÃ©ez un cumul depuis le dÃ©but du semestre jusqu'au trimestre actuel.

### ğŸ’¡ Indice

Utilisez `PeriodsToDate(level, member)`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Semester To Date] AS
  Aggregate(
    PeriodsToDate(
      [Dim Date].[Calendar Hierarchy].[Calendar Semester],
      [Dim Date].[Calendar Hierarchy].CurrentMember
    ),
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Semester To Date]
  } ON COLUMNS,
  Descendants(
    [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013],
    [Dim Date].[Calendar Hierarchy].[Calendar Quarter]
  ) ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `PeriodsToDate(level, member)` : GÃ©nÃ©ralisation de YTD/QTD/MTD
- Premier paramÃ¨tre : niveau jusqu'auquel remonter
- RÃ©sultat : Q1=Q1, Q2=Q1+Q2, Q3=Q3, Q4=Q3+Q4

---

## Exercice 35 : ParallelPeriod() - AnnÃ©e prÃ©cÃ©dente

### ğŸ“ Objectif

Comparer avec la mÃªme pÃ©riode de l'annÃ©e prÃ©cÃ©dente.

### ğŸ“ Ã‰noncÃ©

Affichez les ventes 2013 et les ventes de l'annÃ©e prÃ©cÃ©dente (2012).

### ğŸ’¡ Indice

Utilisez `ParallelPeriod()` pour obtenir la pÃ©riode parallÃ¨le.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Previous Year Sales] AS
  (
    ParallelPeriod(
      [Dim Date].[Calendar Hierarchy].[Calendar Year],
      1,
      [Dim Date].[Calendar Hierarchy].CurrentMember
    ),
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Previous Year Sales]
  } ON COLUMNS,
  Descendants(
    [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013],
    [Dim Date].[Calendar Hierarchy].[Month]
  ) ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `ParallelPeriod(level, n, member)` : PÃ©riode parallÃ¨le n positions avant
- Level : Niveau auquel remonter (Year)
- n : Nombre de pÃ©riodes Ã  reculer (1 = annÃ©e prÃ©cÃ©dente)
- Janvier 2013 â†’ Janvier 2012, FÃ©vrier 2013 â†’ FÃ©vrier 2012, etc.

---

## Exercice 36 : Calcul de croissance (%)

### ğŸ“ Objectif

Calculer le taux de croissance par rapport Ã  l'annÃ©e prÃ©cÃ©dente.

### ğŸ“ Ã‰noncÃ©

CrÃ©ez une mesure qui calcule la croissance des ventes en % par rapport Ã  N-1.

### ğŸ’¡ Indice

Formule : ((Actuel - PrÃ©cÃ©dent) / PrÃ©cÃ©dent) * 100

### âœ… Solution

```mdx
WITH 
MEMBER [Measures].[Previous Year Sales] AS
  (
    ParallelPeriod(
      [Dim Date].[Calendar Hierarchy].[Calendar Year],
      1,
      [Dim Date].[Calendar Hierarchy].CurrentMember
    ),
    [Measures].[Sales Amount]
  )

MEMBER [Measures].[Growth %] AS
  IIF(
    [Measures].[Previous Year Sales] = 0,
    NULL,
    (([Measures].[Sales Amount] - [Measures].[Previous Year Sales]) 
     / [Measures].[Previous Year Sales]) * 100
  ),
  FORMAT_STRING = "0.00"

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Previous Year Sales],
    [Measures].[Growth %]
  } ON COLUMNS,
  [Dim Date].[Calendar Hierarchy].[Calendar Year].MEMBERS ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `IIF()` : Ã‰vite division par zÃ©ro
- `FORMAT_STRING` : Formate le rÃ©sultat (2 dÃ©cimales)
- Retourne NULL si annÃ©e prÃ©cÃ©dente = 0

---

## Exercice 37 : Moyenne mobile (Moving Average)

### ğŸ“ Objectif

Calculer une moyenne mobile sur les 3 derniers mois.

### ğŸ“ Ã‰noncÃ©

CrÃ©ez une mesure "Moving Average 3 Months" qui calcule la moyenne des 3 derniers mois.

### ğŸ’¡ Indice

Utilisez `Avg()` avec `LastPeriods(3, membre)`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Moving Avg 3M] AS
  Avg(
    LastPeriods(
      3,
      [Dim Date].[Calendar Hierarchy].CurrentMember
    ),
    [Measures].[Sales Amount]
  ),
  FORMAT_STRING = "#,##0"

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Moving Avg 3M]
  } ON COLUMNS,
  Descendants(
    [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013],
    [Dim Date].[Calendar Hierarchy].[Month]
  ) ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `LastPeriods(n, member)` : Retourne les n derniÃ¨res pÃ©riodes incluant le membre actuel
- `Avg()` : Calcule la moyenne de ces pÃ©riodes
- RÃ©sultat : Mars = Avg(Jan,Feb,Mar), Avril = Avg(Feb,Mar,Apr), etc.

---

## Exercice 38 : OpeningPeriod() et ClosingPeriod()

### ğŸ“ Objectif

Obtenir la premiÃ¨re et derniÃ¨re pÃ©riode d'un membre.

### ğŸ“ Ã‰noncÃ©

Affichez les ventes du premier et du dernier mois de chaque annÃ©e.

### ğŸ’¡ Indice

Utilisez `OpeningPeriod()` et `ClosingPeriod()`.

### âœ… Solution

```mdx
WITH 
MEMBER [Measures].[First Month Sales] AS
  (
    OpeningPeriod(
      [Dim Date].[Calendar Hierarchy].[Month],
      [Dim Date].[Calendar Hierarchy].CurrentMember
    ),
    [Measures].[Sales Amount]
  )

MEMBER [Measures].[Last Month Sales] AS
  (
    ClosingPeriod(
      [Dim Date].[Calendar Hierarchy].[Month],
      [Dim Date].[Calendar Hierarchy].CurrentMember
    ),
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[First Month Sales],
    [Measures].[Last Month Sales]
  } ON COLUMNS,
  [Dim Date].[Calendar Hierarchy].[Calendar Year].MEMBERS ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `OpeningPeriod(level, member)` : Premier descendant au niveau spÃ©cifiÃ©
- `ClosingPeriod(level, member)` : Dernier descendant au niveau spÃ©cifiÃ©
- Pour 2013 : First = Janvier 2013, Last = DÃ©cembre 2013

---

# PARTIE 4 : CALCULS AVANCÃ‰S

## Exercice 39 : IIF() pour conditions

### ğŸ“ Objectif

CrÃ©er des calculs conditionnels.

### ğŸ“ Ã‰noncÃ©

CrÃ©ez une mesure "Performance Status" qui retourne "High" si ventes > 1M, "Medium" si > 500K, sinon "Low".

### ğŸ’¡ Indice

Imbriquez plusieurs `IIF()`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Performance Status] AS
  IIF(
    [Measures].[Sales Amount] > 1000000,
    "High",
    IIF(
      [Measures].[Sales Amount] > 500000,
      "Medium",
      "Low"
    )
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Performance Status]
  } ON COLUMNS,
  [Dim Product Category].[Product Category].MEMBERS ON ROWS
FROM [Adventure Works]
WHERE [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013]
```

### ğŸ“Š Explication

- `IIF(condition, si_vrai, si_faux)` : Fonction conditionnelle
- Imbrication possible pour plusieurs conditions
- Ã‰quivalent Ã  : IF...ELSE IF...ELSE

---

## Exercice 40 : IsEmpty() pour gÃ©rer les valeurs nulles

### ğŸ“ Objectif

DÃ©tecter et gÃ©rer les valeurs vides.

### ğŸ“ Ã‰noncÃ©

CrÃ©ez une mesure qui affiche "No Data" quand Sales Amount est vide, sinon affiche la valeur.

### ğŸ’¡ Indice

Utilisez `IsEmpty()` avec `IIF()`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Sales With Status] AS
  IIF(
    IsEmpty([Measures].[Sales Amount]),
    "No Data",
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Sales With Status]
  } ON COLUMNS,
  [Dim Product].[Product].MEMBERS ON ROWS
FROM [Adventure Works]
WHERE [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013]
```

### ğŸ“Š Explication

- `IsEmpty(expression)` : Retourne TRUE si la valeur est NULL
- Utile pour afficher des messages personnalisÃ©s
- Alternative : `CoalesceEmpty()` pour valeur par dÃ©faut

---

## Exercice 41 : Rank() pour classements

### ğŸ“ Objectif

Classer les Ã©lÃ©ments selon une mesure.

### ğŸ“ Ã‰noncÃ©

Ajoutez un rang pour chaque catÃ©gorie de produit selon le montant des ventes.

### ğŸ’¡ Indice

Utilisez `Rank(tuple, set)`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Sales Rank] AS
  Rank(
    [Dim Product Category].[Product Category].CurrentMember,
    Order(
      [Dim Product Category].[Product Category].MEMBERS,
      [Measures].[Sales Amount],
      BDESC
    )
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Sales Rank]
  } ON COLUMNS,
  Order(
    [Dim Product Category].[Product Category].MEMBERS,
    [Measures].[Sales Amount],
    BDESC
  ) ON ROWS
FROM [Adventure Works]
WHERE [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013]
```

### ğŸ“Š Explication

- `Rank(tuple, set)` : Position du tuple dans le set (commence Ã  1)
- `BDESC` : Ordre descendant (Break Hierarchy)
- RÃ©sultat : 1 pour le plus grand, 2 pour le deuxiÃ¨me, etc.

---

## Exercice 42 : Contribution en % (Percent of Total)

### ğŸ“ Objectif

Calculer la contribution de chaque Ã©lÃ©ment au total.

### ğŸ“ Ã‰noncÃ©

Calculez le pourcentage de chaque catÃ©gorie de produit par rapport au total des ventes.

### ğŸ’¡ Indice

Divisez la valeur actuelle par le total (ALL).

### âœ… Solution

```mdx
WITH MEMBER [Measures].[% of Total] AS
  ([Measures].[Sales Amount] / 
   ([Measures].[Sales Amount], [Dim Product Category].[Product Category].[(All)])) * 100,
  FORMAT_STRING = "0.00"

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[% of Total]
  } ON COLUMNS,
  [Dim Product Category].[Product Category].MEMBERS ON ROWS
FROM [Adventure Works]
WHERE [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013]
```

### ğŸ“Š Explication

- `[Dimension].[Hierarchy].[(All)]` : Membre racine (total global)
- Division : Valeur actuelle / Total
- Multiplication par 100 pour obtenir un pourcentage

---

## Exercice 43 : CoalesceEmpty() pour valeurs par dÃ©faut

### ğŸ“ Objectif

Remplacer les valeurs vides par une valeur par dÃ©faut.

### ğŸ“ Ã‰noncÃ©

Affichez les ventes, mais remplacez les valeurs vides par 0.

### ğŸ’¡ Indice

Utilisez `CoalesceEmpty()`.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Sales Or Zero] AS
  CoalesceEmpty([Measures].[Sales Amount], 0)

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Sales Or Zero]
  } ON COLUMNS,
  [Dim Product].[Product].MEMBERS ON ROWS
FROM [Adventure Works]
WHERE [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013]
```

### ğŸ“Š Explication

- `CoalesceEmpty(value, default)` : Retourne `default` si `value` est vide
- Peut accepter plusieurs valeurs : `CoalesceEmpty(val1, val2, val3, default)`
- Retourne la premiÃ¨re valeur non-vide

---

## Exercice 44 : Sum() avec filtre

### ğŸ“ Objectif

Sommer uniquement certains Ã©lÃ©ments d'un ensemble.

### ğŸ“ Ã‰noncÃ©

Calculez le total des ventes uniquement pour les catÃ©gories Bikes et Components.

### ğŸ’¡ Indice

Utilisez `Sum()` avec un set filtrÃ©.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Bikes and Components Sales] AS
  Sum(
    {
      [Dim Product Category].[Product Category].&[Bikes],
      [Dim Product Category].[Product Category].&[Components]
    },
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Bikes and Components Sales]
  } ON COLUMNS,
  [Dim Date].[Calendar Hierarchy].[Calendar Year].MEMBERS ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `Sum(set, expression)` : Somme l'expression sur tous les membres du set
- Alternative : `Aggregate()` qui respecte mieux les agrÃ©gations du cube
- RÃ©sultat : Somme des deux catÃ©gories pour chaque annÃ©e

---

## Exercice 45 : Cumul progressif (Running Total)

### ğŸ“ Objectif

Calculer un cumul progressif sur une liste ordonnÃ©e.

### ğŸ“ Ã‰noncÃ©

CrÃ©ez un cumul progressif des ventes mois par mois en 2013.

### ğŸ’¡ Indice

Utilisez `Sum()` avec une plage du premier membre au membre actuel.

### âœ… Solution

```mdx
WITH MEMBER [Measures].[Running Total] AS
  Sum(
    [Dim Date].[Calendar Hierarchy].[Month].MEMBERS.Item(0)
    :
    [Dim Date].[Calendar Hierarchy].CurrentMember,
    [Measures].[Sales Amount]
  )

SELECT
  {
    [Measures].[Sales Amount],
    [Measures].[Running Total]
  } ON COLUMNS,
  Descendants(
    [Dim Date].[Calendar Hierarchy].[Calendar Year].&[2013],
    [Dim Date].[Calendar Hierarchy].[Month]
  ) ON ROWS
FROM [Adventure Works]
```

### ğŸ“Š Explication

- `:` : OpÃ©rateur de plage (range) entre deux membres
- `.Item(0)` : Premier Ã©lÃ©ment de l'ensemble
- `CurrentMember` : Membre actuel dans le contexte
- RÃ©sultat : Cumul du 1er mois au mois actuel

---

## ğŸ“ RÃ©sumÃ© - Partie 3 et 4

Vous avez appris :

- âœ… Fonctions Time Intelligence (YTD, QTD, MTD, PeriodsToDate)
- âœ… Comparaisons temporelles (ParallelPeriod)
- âœ… Moyennes mobiles (LastPeriods + Avg)
- âœ… PÃ©riodes d'ouverture/fermeture (OpeningPeriod, ClosingPeriod)
- âœ… Calculs conditionnels (IIF, IsEmpty)
- âœ… Classements (Rank)
- âœ… Pourcentages et contributions
- âœ… Gestion des valeurs vides (CoalesceEmpty)
- âœ… Cumuls progressifs


