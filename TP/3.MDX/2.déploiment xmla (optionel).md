# Déploiement Rapide via XMLA Script

## Option alternative : Déploiement via script XMLA

Si vous préférez déployer le cube sans passer par Visual Studio, voici un script XMLA simplifié.

## Instructions

1. **Ouvrez SSMS et connectez-vous à Analysis Services**
2. **Fichier → Nouveau → Requête XMLA**
3. **Copiez-collez le script ci-dessous**
4. **Modifiez la chaîne de connexion si nécessaire** (ligne DataSourceID)
5. **Exécutez le script (F5)**

---

## Script XMLA - Création du Cube Adventure Works

**Note importante :** Avant d'exécuter ce script, assurez-vous que :

- La base de données AdventureWorksDW2019 est bien restaurée
- Vous êtes administrateur du serveur SSAS
- Aucune base "AtelierMDX" n'existe déjà (supprimez-la si c'est le cas)

```xml
<Create xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <ParentObject>
    <ServerID>localhost</ServerID>
  </ParentObject>
  <ObjectDefinition>
    <Database xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <ID>AtelierMDX</ID>
      <Name>AtelierMDX</Name>
      <Description>Base de données pour les exercices MDX</Description>

      <!-- Data Source -->
      <DataSources>
        <DataSource>
          <ID>Adventure Works DW</ID>
          <Name>Adventure Works DW</Name>
          <ConnectionString>Provider=SQLNCLI11.1;Data Source=localhost;Integrated Security=SSPI;Initial Catalog=AdventureWorksDW2019</ConnectionString>
          <ImpersonationInfo>
            <ImpersonationMode>ImpersonateServiceAccount</ImpersonationMode>
          </ImpersonationInfo>
        </DataSource>
      </DataSources>

      <!-- Data Source View -->
      <DataSourceViews>
        <DataSourceView>
          <ID>Adventure Works DW</ID>
          <Name>Adventure Works DW</Name>
          <DataSourceID>Adventure Works DW</DataSourceID>
          <Schema>
            <xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:sql="urn:schemas-microsoft-com:xml-sql">
              <!-- Tables principales -->
              <xs:element name="FactInternetSales" />
              <xs:element name="DimDate" />
              <xs:element name="DimProduct" />
              <xs:element name="DimProductCategory" />
              <xs:element name="DimProductSubcategory" />
              <xs:element name="DimCustomer" />
              <xs:element name="DimGeography" />
              <xs:element name="DimSalesTerritory" />
            </xs:schema>
          </Schema>
        </DataSourceView>
      </DataSourceViews>

      <!-- Dimensions simplifiées - seront créées automatiquement par le cube wizard -->

      <!-- Cube -->
      <Cubes>
        <Cube>
          <ID>Adventure Works</ID>
          <Name>Adventure Works</Name>
          <Dimensions>
            <!-- Dimension Date (Order Date) -->
            <Dimension>
              <ID>Dim Date</ID>
              <Name>Order Date</Name>
              <DimensionID>Dim Date</DimensionID>
            </Dimension>

            <!-- Dimension Product -->
            <Dimension>
              <ID>Dim Product</ID>
              <Name>Product</Name>
              <DimensionID>Dim Product</DimensionID>
            </Dimension>

            <!-- Dimension Customer -->
            <Dimension>
              <ID>Dim Customer</ID>
              <Name>Customer</Name>
              <DimensionID>Dim Customer</DimensionID>
            </Dimension>

            <!-- Dimension Sales Territory -->
            <Dimension>
              <ID>Dim Sales Territory</ID>
              <Name>Sales Territory</Name>
              <DimensionID>Dim Sales Territory</DimensionID>
            </Dimension>
          </Dimensions>

          <!-- Measure Groups -->
          <MeasureGroups>
            <MeasureGroup>
              <ID>Fact Internet Sales</ID>
              <Name>Internet Sales</Name>
              <Measures>
                <Measure>
                  <ID>Sales Amount</ID>
                  <Name>Sales Amount</Name>
                  <AggregateFunction>Sum</AggregateFunction>
                  <Source>
                    <DataType>Double</DataType>
                    <Source xsi:type="ColumnBinding">
                      <TableID>dbo_FactInternetSales</TableID>
                      <ColumnID>SalesAmount</ColumnID>
                    </Source>
                  </Source>
                </Measure>

                <Measure>
                  <ID>Order Quantity</ID>
                  <Name>Order Quantity</Name>
                  <AggregateFunction>Sum</AggregateFunction>
                  <Source>
                    <DataType>Integer</DataType>
                    <Source xsi:type="ColumnBinding">
                      <TableID>dbo_FactInternetSales</TableID>
                      <ColumnID>OrderQuantity</ColumnID>
                    </Source>
                  </Source>
                </Measure>

                <Measure>
                  <ID>Total Product Cost</ID>
                  <Name>Total Product Cost</Name>
                  <AggregateFunction>Sum</AggregateFunction>
                  <Source>
                    <DataType>Double</DataType>
                    <Source xsi:type="ColumnBinding">
                      <TableID>dbo_FactInternetSales</TableID>
                      <ColumnID>TotalProductCost</ColumnID>
                    </Source>
                  </Source>
                </Measure>

                <Measure>
                  <ID>Internet Sales Count</ID>
                  <Name>Internet Sales Count</Name>
                  <AggregateFunction>Count</AggregateFunction>
                </Measure>
              </Measures>
            </MeasureGroup>
          </MeasureGroups>
        </Cube>
      </Cubes>
    </Database>
  </ObjectDefinition>
</Create>
```

---

## Méthode recommandée : Utiliser le script PowerShell

Pour un déploiement plus fiable, utilisez PowerShell avec le module SqlServer :

### Script PowerShell de déploiement

```powershell
# Installer le module si nécessaire
Install-Module -Name SqlServer -Scope CurrentUser

# Variables
$serverName = "localhost"
$databaseName = "AtelierMDX"
$sourceDB = "AdventureWorksDW2019"

# Charger les assemblies Analysis Services
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.AnalysisServices") | Out-Null

# Se connecter au serveur
$server = New-Object Microsoft.AnalysisServices.Server
$server.Connect($serverName)

Write-Host "Connecté au serveur: $serverName"

# Supprimer la base si elle existe déjà
if ($server.Databases.Contains($databaseName)) {
    Write-Host "Suppression de la base existante..."
    $server.Databases[$databaseName].Drop()
    $server.Update()
}

# Créer la nouvelle base de données
Write-Host "Création de la base de données $databaseName..."
$database = New-Object Microsoft.AnalysisServices.Database($databaseName, $databaseName)
$server.Databases.Add($database)
$database.Update()

# Créer la Data Source
Write-Host "Création de la Data Source..."
$dataSource = New-Object Microsoft.AnalysisServices.RelationalDataSource
$dataSource.ID = "Adventure Works DW"
$dataSource.Name = "Adventure Works DW"
$dataSource.ConnectionString = "Provider=SQLNCLI11.1;Data Source=$serverName;Integrated Security=SSPI;Initial Catalog=$sourceDB"
$dataSource.ImpersonationInfo = New-Object Microsoft.AnalysisServices.ImpersonationInfo
$dataSource.ImpersonationInfo.ImpersonationMode = [Microsoft.AnalysisServices.ImpersonationMode]::ImpersonateServiceAccount

$database.DataSources.Add($dataSource)
$database.Update()

Write-Host "Base de données créée avec succès!"
Write-Host "Utilisez maintenant le Cube Wizard dans Visual Studio pour créer le cube."

# Déconnexion
$server.Disconnect()
```

### Exécution du script PowerShell

1. Ouvrez PowerShell en tant qu'administrateur
2. Naviguez vers le répertoire contenant le script
3. Exécutez : `.\Deploy-AtelierMDX.ps1`

---

## Recommandation finale

**Pour cet atelier, je recommande la méthode manuelle via Visual Studio** (décrite dans 01_Configuration_Environnement.md) car :

1. ✅ Plus pédagogique - vous comprenez chaque étape
2. ✅ Plus visuel - vous voyez la structure du cube
3. ✅ Plus flexible - vous pouvez ajuster les hiérarchies facilement
4. ✅ Meilleur pour l'apprentissage de MDX

Le script XMLA/PowerShell est utile pour :

- Déploiements automatisés en production
- Scripts d'intégration continue (CI/CD)
- Restauration rapide après erreur

**Passez maintenant aux exercices MDX dans le fichier 03_Exercices_MDX.md !**
