# GUIDE EXPERT : CRÉATION DE KPI AVANCÉS DANS SSAS

## Architecture KPI Hiérarchique - Expertise 30 ans

---

## PHILOSOPHIE DES KPI : VISION D'EXPERT

### Qu'est-ce qu'un KPI de qualité ?

Un KPI (Key Performance Indicator) n'est pas simplement une mesure avec un objectif. C'est un **instrument de pilotage décisionnel** qui doit respecter ces principes fondamentaux :

1. **SMART** :
   
   - **Specific** : Lié à un objectif métier précis
   - **Measurable** : Quantifiable et vérifiable
   - **Achievable** : Réaliste et atteignable
   - **Relevant** : Pertinent pour la décision
   - **Time-bound** : Contextualisé dans le temps

2. **Actionnable** : Un KPI doit déclencher une action
   
   - Rouge → Action corrective immédiate
   - Orange → Attention et surveillance
   - Vert → Maintenir la performance

3. **Contextualisé** :
   
   - Comparaison vs objectif
   - Comparaison vs période précédente
   - Comparaison vs concurrence (benchmark)

---

## ARCHITECTURE KPI PROPOSÉE

### Vision Hiérarchique (3 niveaux)

```
NIVEAU 1 - STRATÉGIQUE (Direction Générale)
│
├─ KPI Master : Performance Globale Entreprise
│
└─ NIVEAU 2 - TACTIQUE (Directeurs)
   │
   ├─ KPI Commercial Global
   │  ├─ NIVEAU 3 - OPÉRATIONNEL
   │  │  ├─ KPI Ventes par Canal
   │  │  ├─ KPI Marge par Produit
   │  │  └─ KPI Croissance YoY
   │  │
   ├─ KPI Qualité Client
   │  ├─ NIVEAU 3 - OPÉRATIONNEL
   │  │  ├─ KPI Satisfaction Client
   │  │  ├─ KPI Taux de Retour
   │  │  └─ KPI Livraison à Temps
   │  │
   ├─ KPI Opérationnel
   │  ├─ NIVEAU 3 - OPÉRATIONNEL
   │  │  ├─ KPI Rotation Stock
   │  │  ├─ KPI Rupture Stock
   │  │  └─ KPI Performance Fournisseurs
   │  │
   └─ KPI Équipe Commerciale
      ├─ NIVEAU 3 - OPÉRATIONNEL
      │  ├─ KPI Performance Vendeur
      │  ├─ KPI Atteinte Quota
      │  └─ KPI Nouveaux Clients
```

---

## PARTIE 1 : KPI STRATÉGIQUE (NIVEAU 1)

### KPI 1.1 : PERFORMANCE GLOBALE ENTREPRISE

**Objectif** : Vue synthétique de la santé de l'entreprise

```mdx
/* 
===================================================
KPI MASTER - PERFORMANCE GLOBALE
===================================================
Ce KPI agrège plusieurs dimensions de performance
*/

-- ÉTAPE 1 : Créer dans Cube Designer > KPIs > New KPI

Name: Global_Performance

Associated Measure Group: FactSales

-- VALUE EXPRESSION
/*
Formule composite pondérée :
- 40% Atteinte objectif ventes
- 30% Marge réalisée
- 20% Satisfaction client
- 10% Croissance YoY
*/

(
    -- Composante 1 : Atteinte des ventes (40%)
    0.40 * ([Measures].[NetSalesAmount] / [Measures].[SalesTarget])
    +
    -- Composante 2 : Marge (30%)
    0.30 * ([Measures].[Margin Percentage] / 0.45)
    +
    -- Composante 3 : Satisfaction (20%)
    0.20 * ([Measures].[OverallSatisfactionScore] / 5.0)
    +
    -- Composante 4 : Croissance (10%)
    0.10 * IIF(
        [Measures].[Sales PY] > 0,
        1 + ([Measures].[Sales Growth YoY]),
        1
    )
)

-- GOAL EXPRESSION
1.0
/* Objectif = 100% de l'indice composite */

-- STATUS EXPRESSION
/*
Seuils experts :
>= 0.95 (95%) = Excellent (1)
>= 0.85 (85%) = Bon (0.5)
< 0.85 = Attention (-1)
*/

CASE
    WHEN KpiValue("Global_Performance") >= 0.95 THEN 1
    WHEN KpiValue("Global_Performance") >= 0.85 THEN 0.5
    WHEN KpiValue("Global_Performance") < 0.85 THEN -1
    ELSE 0
END

-- TREND EXPRESSION
/*
Compare performance actuelle vs période précédente
*/

CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Global_Performance")
        )
    ) THEN 0
    WHEN KpiValue("Global_Performance") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Global_Performance")
        ) * 1.03 THEN 1  -- +3% = trend positif
    WHEN KpiValue("Global_Performance") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Global_Performance")
        ) * 0.97 THEN -1  -- -3% = trend négatif
    ELSE 0  -- Stable
END

-- STATUS INDICATOR: Gauge
-- TREND INDICATOR: Variance arrow

-- DISPLAY FOLDER: "1. Strategic KPIs"
```

---

## PARTIE 2 : KPI TACTIQUES (NIVEAU 2)

### KPI 2.1 : COMMERCIAL GLOBAL (Parent)

```mdx
/* 
===================================================
KPI PARENT - PERFORMANCE COMMERCIALE GLOBALE
===================================================
*/

Name: Commercial_Performance

Parent KPI: Global_Performance

Associated Measure Group: FactSales

-- VALUE EXPRESSION
/*
Indice composite commercial :
- 50% Atteinte ventes
- 30% Marge
- 20% Nouveaux clients
*/

(
    0.50 * ([Measures].[NetSalesAmount] / [Measures].[SalesTarget])
    +
    0.30 * ([Measures].[Margin Percentage] / 0.45)
    +
    0.20 * (
        COUNT(
            FILTER(
                [DimCustomer].[CustomerType].[CustomerType].Members,
                [DimCustomer].[CustomerType].CurrentMember.Name = "New"
            )
        ) / 10.0  -- Objectif 10 nouveaux clients/période
    )
)

-- GOAL EXPRESSION
1.0

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Commercial_Performance") >= 0.95 THEN 1
    WHEN KpiValue("Commercial_Performance") >= 0.85 THEN 0.5
    WHEN KpiValue("Commercial_Performance") >= 0.75 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Commercial_Performance")
        )
    ) THEN 0
    WHEN KpiValue("Commercial_Performance") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Commercial_Performance")
        ) * 1.02 THEN 1
    WHEN KpiValue("Commercial_Performance") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Commercial_Performance")
        ) * 0.98 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Traffic Light
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "2. Tactical KPIs/Commercial"
```

### KPI 2.2 : QUALITÉ CLIENT (Parent)

```mdx
/* 
===================================================
KPI PARENT - QUALITÉ ET SATISFACTION CLIENT
===================================================
*/

Name: Customer_Quality

Parent KPI: Global_Performance

Associated Measure Group: FactCustomerSatisfaction

-- VALUE EXPRESSION
/*
Indice qualité client :
- 40% Satisfaction globale
- 30% NPS
- 20% Taux de retour (inversé)
- 10% Livraison à temps
*/

(
    0.40 * ([Measures].[OverallSatisfactionScore] / 5.0)
    +
    0.30 * (([Measures].[NetPromoterScore] + 10) / 20.0)  -- Normalisation -10 à +10 => 0 à 1
    +
    0.20 * (1 - [Measures].[Return Rate])  -- Inversé car moins = mieux
    +
    0.10 * (1 - [Measures].[Late Delivery Rate])  -- Inversé
)

-- GOAL EXPRESSION
0.90  -- Objectif 90% de l'indice

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Customer_Quality") / KpiGoal("Customer_Quality") >= 1.05 THEN 1
    WHEN KpiValue("Customer_Quality") / KpiGoal("Customer_Quality") >= 0.95 THEN 0.5
    WHEN KpiValue("Customer_Quality") / KpiGoal("Customer_Quality") >= 0.85 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Customer_Quality")
        )
    ) THEN 0
    WHEN KpiValue("Customer_Quality") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Customer_Quality")
        ) * 1.01 THEN 1
    WHEN KpiValue("Customer_Quality") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Customer_Quality")
        ) * 0.99 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Shapes (Smiley Faces)
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "2. Tactical KPIs/Customer Quality"
```

### KPI 2.3 : OPÉRATIONNEL (Parent)

```mdx
/* 
===================================================
KPI PARENT - EXCELLENCE OPÉRATIONNELLE
===================================================
*/

Name: Operational_Excellence

Parent KPI: Global_Performance

Associated Measure Group: FactInventory

-- VALUE EXPRESSION
/*
Indice opérationnel :
- 40% Rotation des stocks
- 30% Disponibilité (pas de rupture)
- 30% Performance fournisseurs
*/

(
    0.40 * ([Measures].[Stock Turnover] / 4.0)  -- Objectif 4 rotations/an
    +
    0.30 * (1 - [Measures].[Stockout Rate])
    +
    0.30 * (
        -- Performance fournisseurs (from FactPurchase)
        AVG([Measures].[IsOnTime])
    )
)

-- GOAL EXPRESSION
0.85  -- Objectif 85%

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Operational_Excellence") / KpiGoal("Operational_Excellence") >= 1.10 THEN 1
    WHEN KpiValue("Operational_Excellence") / KpiGoal("Operational_Excellence") >= 0.95 THEN 0.5
    WHEN KpiValue("Operational_Excellence") / KpiGoal("Operational_Excellence") >= 0.80 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Operational_Excellence")
        )
    ) THEN 0
    WHEN KpiValue("Operational_Excellence") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Operational_Excellence")
        ) * 1.03 THEN 1
    WHEN KpiValue("Operational_Excellence") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Operational_Excellence")
        ) * 0.97 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Cylinder
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "2. Tactical KPIs/Operations"
```

---

## PARTIE 3 : KPI OPÉRATIONNELS (NIVEAU 3)

### KPI 3.1 : VENTES PAR CANAL (Enfant de Commercial_Performance)

```mdx
/* 
===================================================
KPI ENFANT - PERFORMANCE PAR CANAL
===================================================
Mesure détaillée pour chaque canal de distribution
*/

Name: Sales_By_Channel

Parent KPI: Commercial_Performance

Associated Measure Group: FactSales

-- VALUE EXPRESSION
-- Ventes réalisées par canal
[Measures].[NetSalesAmount]

-- GOAL EXPRESSION
/*
Objectifs différenciés par canal :
- Online : Croissance 20% vs N-1
- Store : Maintien
- Partner : Croissance 15%
- Direct : Croissance 10%
*/

CASE [DimChannel].[ChannelType].CurrentMember.Name
    WHEN "Online" THEN 
        (ParallelPeriod([DimTime].[Calendar].[Year], 1), [Measures].[NetSalesAmount]) * 1.20
    WHEN "Partner" THEN 
        (ParallelPeriod([DimTime].[Calendar].[Year], 1), [Measures].[NetSalesAmount]) * 1.15
    WHEN "Direct" THEN 
        (ParallelPeriod([DimTime].[Calendar].[Year], 1), [Measures].[NetSalesAmount]) * 1.10
    ELSE 
        (ParallelPeriod([DimTime].[Calendar].[Year], 1), [Measures].[NetSalesAmount])
END

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Sales_By_Channel") / KpiGoal("Sales_By_Channel") >= 1.10 THEN 1
    WHEN KpiValue("Sales_By_Channel") / KpiGoal("Sales_By_Channel") >= 0.95 THEN 0.5
    WHEN KpiValue("Sales_By_Channel") / KpiGoal("Sales_By_Channel") >= 0.85 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Sales_By_Channel")
        )
    ) THEN 0
    WHEN KpiValue("Sales_By_Channel") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Sales_By_Channel")
        ) * 1.05 THEN 1
    WHEN KpiValue("Sales_By_Channel") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Sales_By_Channel")
        ) * 0.95 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Road Signs
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Sales by Channel"
```

### KPI 3.2 : MARGE PAR CATÉGORIE PRODUIT (Enfant de Commercial_Performance)

```mdx
/* 
===================================================
KPI ENFANT - MARGE PAR CATÉGORIE
===================================================
Pilotage fin de la rentabilité par catégorie
*/

Name: Margin_By_Category

Parent KPI: Commercial_Performance

Associated Measure Group: FactSales

-- VALUE EXPRESSION
-- Marge réelle en pourcentage
[Measures].[Margin Percentage]

-- GOAL EXPRESSION
/*
Objectifs de marge par catégorie :
- Électronique : 42%
- Électroménager : 38%
- Meubles : 48%
- Décoration : 52%
- Jardin : 45%
*/

CASE [DimProduct].[ProductCategory].CurrentMember.Name
    WHEN "Électronique" THEN 0.42
    WHEN "Électroménager" THEN 0.38
    WHEN "Meubles" THEN 0.48
    WHEN "Décoration" THEN 0.52
    WHEN "Jardin" THEN 0.45
    ELSE 0.45  -- Default
END

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Margin_By_Category") >= KpiGoal("Margin_By_Category") * 1.05 THEN 1
    WHEN KpiValue("Margin_By_Category") >= KpiGoal("Margin_By_Category") * 0.95 THEN 0.5
    WHEN KpiValue("Margin_By_Category") >= KpiGoal("Margin_By_Category") * 0.85 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Margin_By_Category")
        )
    ) THEN 0
    WHEN KpiValue("Margin_By_Category") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Margin_By_Category")
        ) + 0.01 THEN 1  -- +1 point
    WHEN KpiValue("Margin_By_Category") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Margin_By_Category")
        ) - 0.01 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Gauge
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Margin by Category"
```

### KPI 3.3 : CROISSANCE YoY (Enfant de Commercial_Performance)

```mdx
/* 
===================================================
KPI ENFANT - CROISSANCE ANNÉE SUR ANNÉE
===================================================
*/

Name: Sales_Growth_YoY

Parent KPI: Commercial_Performance

Associated Measure Group: FactSales

-- VALUE EXPRESSION
[Measures].[Sales Growth YoY]

-- GOAL EXPRESSION
0.15  -- Objectif 15% de croissance

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Sales_Growth_YoY") >= 0.20 THEN 1      -- >20% = Excellent
    WHEN KpiValue("Sales_Growth_YoY") >= 0.15 THEN 0.5    -- 15-20% = Bon
    WHEN KpiValue("Sales_Growth_YoY") >= 0.10 THEN 0      -- 10-15% = Acceptable
    ELSE -1                                                -- <10% = Insuffisant
END

-- TREND EXPRESSION
/*
Compare la croissance actuelle vs celle du trimestre précédent
*/

CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Sales_Growth_YoY")
        )
    ) THEN 0
    WHEN KpiValue("Sales_Growth_YoY") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Sales_Growth_YoY")
        ) + 0.02 THEN 1  -- Accélération
    WHEN KpiValue("Sales_Growth_YoY") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Sales_Growth_YoY")
        ) - 0.02 THEN -1  -- Décélération
    ELSE 0
END

-- STATUS INDICATOR: Traffic Light
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Growth"
```

### KPI 3.4 : SATISFACTION CLIENT (Enfant de Customer_Quality)

```mdx
/* 
===================================================
KPI ENFANT - SATISFACTION CLIENT
===================================================
*/

Name: Customer_Satisfaction

Parent KPI: Customer_Quality

Associated Measure Group: FactCustomerSatisfaction

-- VALUE EXPRESSION
[Measures].[OverallSatisfactionScore]

-- GOAL EXPRESSION
4.2  -- Objectif 4.2/5

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Customer_Satisfaction") >= 4.5 THEN 1
    WHEN KpiValue("Customer_Satisfaction") >= 4.0 THEN 0.5
    WHEN KpiValue("Customer_Satisfaction") >= 3.5 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Customer_Satisfaction")
        )
    ) THEN 0
    WHEN KpiValue("Customer_Satisfaction") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Customer_Satisfaction")
        ) + 0.1 THEN 1
    WHEN KpiValue("Customer_Satisfaction") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Customer_Satisfaction")
        ) - 0.1 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Faces (Smiley)
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Customer Experience"
```

### KPI 3.5 : TAUX DE RETOUR (Enfant de Customer_Quality)

```mdx
/* 
===================================================
KPI ENFANT - TAUX DE RETOUR PRODUITS
===================================================
*/

Name: Return_Rate

Parent KPI: Customer_Quality

Associated Measure Group: FactSales

-- VALUE EXPRESSION
[Measures].[Return Rate]

-- GOAL EXPRESSION
0.03  -- Objectif max 3%

-- STATUS EXPRESSION
/*
ATTENTION: Pour ce KPI, MOINS = MIEUX
Donc la logique est inversée
*/

CASE
    WHEN KpiValue("Return_Rate") <= 0.02 THEN 1       -- <2% = Excellent
    WHEN KpiValue("Return_Rate") <= 0.03 THEN 0.5     -- 2-3% = Acceptable
    WHEN KpiValue("Return_Rate") <= 0.05 THEN 0       -- 3-5% = Attention
    ELSE -1                                            -- >5% = Critique
END

-- TREND EXPRESSION
/*
INVERSÉ: baisse = positif, hausse = négatif
*/

CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Return_Rate")
        )
    ) THEN 0
    WHEN KpiValue("Return_Rate") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Return_Rate")
        ) * 0.90 THEN 1  -- Baisse >10% = positif
    WHEN KpiValue("Return_Rate") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Return_Rate")
        ) * 1.10 THEN -1  -- Hausse >10% = négatif
    ELSE 0
END

-- STATUS INDICATOR: Reversed Gauge
-- TREND INDICATOR: Variance Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Customer Experience"
```

### KPI 3.6 : LIVRAISON À TEMPS (Enfant de Customer_Quality)

```mdx
/* 
===================================================
KPI ENFANT - RESPECT DÉLAIS LIVRAISON
===================================================
*/

Name: On_Time_Delivery

Parent KPI: Customer_Quality

Associated Measure Group: FactSales

-- VALUE EXPRESSION
1 - [Measures].[Late Delivery Rate]  -- Taux de livraison à temps

-- GOAL EXPRESSION
0.95  -- Objectif 95% à temps

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("On_Time_Delivery") >= 0.98 THEN 1
    WHEN KpiValue("On_Time_Delivery") >= 0.95 THEN 0.5
    WHEN KpiValue("On_Time_Delivery") >= 0.90 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("On_Time_Delivery")
        )
    ) THEN 0
    WHEN KpiValue("On_Time_Delivery") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("On_Time_Delivery")
        ) + 0.01 THEN 1
    WHEN KpiValue("On_Time_Delivery") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("On_Time_Delivery")
        ) - 0.01 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Thermometer
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Customer Experience"
```

### KPI 3.7 : ROTATION DES STOCKS (Enfant de Operational_Excellence)

```mdx
/* 
===================================================
KPI ENFANT - ROTATION DES STOCKS
===================================================
*/

Name: Stock_Turnover_Rate

Parent KPI: Operational_Excellence

Associated Measure Group: FactInventory

-- VALUE EXPRESSION
[Measures].[Stock Turnover]

-- GOAL EXPRESSION
4.0  -- Objectif 4 rotations par an

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Stock_Turnover_Rate") >= 5.0 THEN 1
    WHEN KpiValue("Stock_Turnover_Rate") >= 4.0 THEN 0.5
    WHEN KpiValue("Stock_Turnover_Rate") >= 3.0 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Stock_Turnover_Rate")
        )
    ) THEN 0
    WHEN KpiValue("Stock_Turnover_Rate") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Stock_Turnover_Rate")
        ) * 1.10 THEN 1
    WHEN KpiValue("Stock_Turnover_Rate") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Stock_Turnover_Rate")
        ) * 0.90 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Cylinder
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Inventory Management"
```

### KPI 3.8 : DISPONIBILITÉ PRODUITS (Enfant de Operational_Excellence)

```mdx
/* 
===================================================
KPI ENFANT - DISPONIBILITÉ / PAS DE RUPTURE
===================================================
*/

Name: Product_Availability

Parent KPI: Operational_Excellence

Associated Measure Group: FactInventory

-- VALUE EXPRESSION
1 - [Measures].[Stockout Rate]

-- GOAL EXPRESSION
0.98  -- 98% de disponibilité (max 2% rupture)

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Product_Availability") >= 0.99 THEN 1
    WHEN KpiValue("Product_Availability") >= 0.97 THEN 0.5
    WHEN KpiValue("Product_Availability") >= 0.95 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Product_Availability")
        )
    ) THEN 0
    WHEN KpiValue("Product_Availability") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Product_Availability")
        ) + 0.005 THEN 1
    WHEN KpiValue("Product_Availability") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Product_Availability")
        ) - 0.005 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Traffic Light
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Inventory Management"
```

### KPI 3.9 : PERFORMANCE FOURNISSEURS (Enfant de Operational_Excellence)

```mdx
/* 
===================================================
KPI ENFANT - PERFORMANCE FOURNISSEURS
===================================================
*/

Name: Supplier_Performance

Parent KPI: Operational_Excellence

Associated Measure Group: FactPurchase

-- VALUE EXPRESSION
/*
Indice composite :
- 60% Livraison à temps
- 30% Taux de qualité (1 - taux de rejet)
- 10% Respect quantités
*/

(
    0.60 * AVG([Measures].[IsOnTime])
    +
    0.30 * (1 - AVG([Measures].[DefectRate]) / 100.0)
    +
    0.10 * (AVG([Measures].[ReceivedQuantity]) / AVG([Measures].[OrderQuantity]))
)

-- GOAL EXPRESSION
0.90  -- 90%

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Supplier_Performance") >= 0.95 THEN 1
    WHEN KpiValue("Supplier_Performance") >= 0.85 THEN 0.5
    WHEN KpiValue("Supplier_Performance") >= 0.75 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Supplier_Performance")
        )
    ) THEN 0
    WHEN KpiValue("Supplier_Performance") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Supplier_Performance")
        ) * 1.02 THEN 1
    WHEN KpiValue("Supplier_Performance") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Quarter], 1),
            KpiValue("Supplier_Performance")
        ) * 0.98 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Road Signs
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Supply Chain"
```

### KPI 3.10 : PERFORMANCE VENDEUR (Enfant implicite)

```mdx
/* 
===================================================
KPI ENFANT - ATTEINTE QUOTA VENDEUR
===================================================
Permet le drill-down par vendeur individuel
*/

Name: Salesperson_Quota_Achievement

Parent KPI: Commercial_Performance

Associated Measure Group: FactSales

-- VALUE EXPRESSION
[Measures].[NetSalesAmount]

-- GOAL EXPRESSION
/*
Utilise le quota annuel du vendeur, proratisé par période
*/

[Measures].[SalesTarget]

-- STATUS EXPRESSION
CASE
    WHEN KpiValue("Salesperson_Quota_Achievement") / KpiGoal("Salesperson_Quota_Achievement") >= 1.10 THEN 1
    WHEN KpiValue("Salesperson_Quota_Achievement") / KpiGoal("Salesperson_Quota_Achievement") >= 0.95 THEN 0.5
    WHEN KpiValue("Salesperson_Quota_Achievement") / KpiGoal("Salesperson_Quota_Achievement") >= 0.85 THEN 0
    ELSE -1
END

-- TREND EXPRESSION
CASE
    WHEN IsEmpty(
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Salesperson_Quota_Achievement")
        )
    ) THEN 0
    WHEN KpiValue("Salesperson_Quota_Achievement") > 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Salesperson_Quota_Achievement")
        ) * 1.05 THEN 1
    WHEN KpiValue("Salesperson_Quota_Achievement") < 
        (
            ParallelPeriod([DimTime].[Calendar].[Month], 1),
            KpiValue("Salesperson_Quota_Achievement")
        ) * 0.95 THEN -1
    ELSE 0
END

-- STATUS INDICATOR: Gauge
-- TREND INDICATOR: Standard Arrow
-- DISPLAY FOLDER: "3. Operational KPIs/Sales Team Performance"
```

---

## GUIDE DE CRÉATION DANS SSDT

### Procédure étape par étape :

1. **Ouvrir le Cube Designer**
   
   - Double-cliquer sur le cube dans l'Explorateur de solutions
   - Aller à l'onglet **KPIs**

2. **Créer le KPI Master d'abord**
   
   - Cliquer **New KPI** dans la barre d'outils
   - Copier-coller les expressions MDX ci-dessus
   - Parent KPI : (None) pour le premier

3. **Créer les KPI Parents (Niveau 2)**
   
   - New KPI
   - Définir Parent KPI = Global_Performance
   - Copier expressions MDX

4. **Créer les KPI Enfants (Niveau 3)**
   
   - New KPI
   - Définir Parent KPI approprié
   - Copier expressions MDX

5. **Configurer les indicateurs visuels**
   
   - Status Indicator : Choisir parmi Gauge, Traffic Light, Shapes, etc.
   - Trend Indicator : Standard Arrow, Variance Arrow

6. **Organiser avec Display Folders**
   
   - Facilite la navigation pour les utilisateurs
   - Groupement logique

7. **Build et Deploy**
   
   - Build > Deploy Solution
   - Vérifier qu'il n'y a pas d'erreurs

8. **Process le cube**
   
   - Dans SSMS : Process Full sur le cube
   - Attendre la fin du traitement

---

## PROCHAINE ÉTAPE

Voir le fichier **`6_Test_KPI_Analysis.md`** pour :

- Tester les KPI dans le Browser
- Créer des rapports avec Excel
- Analyser les résultats
- Conclusions d'expert

---
