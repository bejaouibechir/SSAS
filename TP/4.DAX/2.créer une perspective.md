## Atelier : Création et utilisation d'une perspective en SSAS Tabulaire

Ce atelier vous guide pour créer une **perspective** dans **SSDT** afin de simplifier le modèle 

### Étape 1 : Créer la perspective dans SSDT

- Ouvrez votre projet dans **SSDT**.
- Dans l'**Explorateur de modèles**, cliquez droit sur **Perspectives** et sélectionnez **Nouvelle perspective**.
- Nommez-la **Ventes Internet**.
- Dans la grille de perspective, cochez les éléments à inclure :  
  - Tables : **FactInternetSales**, **DimDate**, **DimProduct**, **DimCustomer**, **DimPromotion**, **DimCurrency**, **DimSalesTerritory**.  
  - Mesures : **Net Income** (créée précédemment).  
  - Colonnes : Sélectionnez uniquement les colonnes pertinentes (ex. : excluez les colonnes inutiles comme descriptions multilingues).  
  - Hiérarchies : Incluez **Calendar Hierarchy** de **DimDate**.
- **Enregistrez** les modifications.

### Étape 2 : Traiter le modèle

- Cliquez droit sur le projet dans l'**Explorateur de solutions** et sélectionnez **Traiter** > **Traiter tout**.
- Choisissez **Traiter par défaut** et exécutez.
- Vérifiez la fenêtre **Sortie** pour confirmer le traitement sans erreurs.
- **Traiter** le modèle sur le serveur **SSAS** (clic droit sur le projet > **Traiter**).

### Étape 3 : Utiliser la perspective dans SSMS

- Ouvrez **SSMS** et connectez-vous au serveur **SSAS** (type : Analysis Services).
- Dans l'**Explorateur d'objets**, naviguez vers la base de données déployée.
- Cliquez droit sur la base et sélectionnez **Nouvelle requête** > **DAX**.
- Pour utiliser la perspective, ajoutez **PERSPECTIVE='Ventes Internet'** 
  
  Connectez-vous via **Excel** ou **Power BI** en sélectionnant la perspective lors de la connexion pour un test visuel.

Oui, absolument ! Les **perspectives** que vous avez créées dans votre modèle SSAS Tabulaire (comme **Ventes Internet**) sont particulièrement utiles et visibles dans des outils comme **Excel** et **Power BI**, où elles simplifient grandement l'expérience des utilisateurs finaux.

### 1. Dans **Excel** (via PivotTable)

Excel est l'outil le plus simple et le plus direct pour tester une perspective.

- Ouvrez **Excel**.
- Allez dans l'onglet **Données** > **Obtenir des données** > **À partir de la base de données** > **À partir de Analysis Services** (ou **À partir d'Analysis Services** selon la version).
- Dans la fenêtre de connexion :
  - **Serveur** : Entrez le nom du serveur SSAS (ex. : `localhost` ou `nom-serveur\instance`).
  - Choisissez **Connexion Windows** (ou les identifiants si besoin).
- Cliquez sur **Suivant** → Vous arrivez à l'écran **Sélectionner la base de données et la table**.
- Dans la liste déroulante **Base de données** : Sélectionnez votre base déployée.
- Dans la liste **Perspective** (ou **Cube** / **Perspective**) : Choisissez explicitement **Ventes Internet** (elle apparaît comme une option séparée).
- Cliquez sur **Suivant** > **Terminer** > **OK** pour créer la **PivotTable**.
- Dans la liste des champs PivotTable : Vous ne verrez **que** les tables, colonnes, hiérarchies (comme Calendar Hierarchy) et mesures (comme Net Income) que vous avez incluses dans la perspective. Tout le reste est caché → super propre !

Alternative rapide depuis SSDT/Visual Studio :

- Dans SSDT, clic droit sur le projet > **Analyser dans Excel** → Une boîte de dialogue apparaît pour choisir la **perspective** avant d'ouvrir Excel.

### 2. Dans **Power BI Desktop**

Power BI supporte très bien les perspectives en connexion **live**.

- Ouvrez **Power BI Desktop**.
- Cliquez sur **Obtenir des données** > **Plus...** > **Base de données** > **SQL Server Analysis Services**.
- Entrez le **nom du serveur** SSAS.
- Choisissez le mode de connexion : **Connexion directe** (Live connection) → recommandé.
- Cliquez sur **OK**.
- Dans la fenêtre **Navigateur** :
  - Vous verrez la liste des modèles/perspectives disponibles.
  - Sélectionnez directement **Ventes Internet** (elle apparaît comme une entrée distincte, pas juste le modèle complet).
- Cliquez sur **Se connecter** ou **Charger**.
- Dans le volet **Champs** de Power BI : Seuls les objets de la perspective **Ventes Internet** sont visibles (tables limitées, hiérarchie Calendar, mesure Net Income, etc.). Parfait pour créer des rapports focalisés sur les ventes internet sans surcharger l'utilisateur.

**Astuce** : Si vous publiez ce rapport Power BI sur le service Power BI (Premium ou avec gateway pour on-prem SSAS), les utilisateurs finaux verront aussi la perspective quand ils se connectent via "Analyser dans Excel" depuis le service.

En résumé :

- **Excel** → Idéal pour tester rapidement avec PivotTable + sélection explicite de la perspective.
- **Power BI** → Meilleur pour des rapports visuels riches, avec la perspective qui filtre automatiquement les champs.


