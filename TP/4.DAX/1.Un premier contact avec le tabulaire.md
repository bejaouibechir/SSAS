# Tutoriel : Premier contact avec SSDT pour SSAS Tabulaire

## Section 1 : Un premier contact

### 1. Créer une hiérarchie Calendar Hierarchy de date à partir de DimDate

- Ouvrez votre projet dans **SSDT**.
- Dans l'**Explorateur de modèles**, sélectionnez la table **DimDate**.
- Dans la vue **Diagramme** ou **Modèle**, cliquez droit sur les colonnes et sélectionnez **Créer une hiérarchie**.
- Nommez-la **Calendar Hierarchy**.
- Ajoutez les niveaux dans l'ordre : **CalendarYear**, **CalendarQuarter**, **FrenchMonthName** (comme déjà défini dans le modèle).
- **Enregistrez** les modifications.

### 2. Créer une mesure depuis FactInternetSales

- Sélectionnez la table **FactInternetSales** dans l'**Explorateur de modèles**.
- Dans la vue **Grille**, cliquez sur une cellule vide sous les colonnes existantes.
- Dans la barre de formule, entrez :  
  **Net Income := SUMX(FactInternetSales, FactInternetSales[OrderQuantity] * (FactInternetSales[UnitPrice] - FactInternetSales[TaxAmt]))**
- **Validez** la mesure et **enregistrez**.

### 3. Déployer la première version du modèle

- Dans **SSDT**, cliquez droit sur le projet dans l'**Explorateur de solutions** et sélectionnez **Déployer**.
- Configurez le **serveur SSAS** cible (par exemple, localhost ou un serveur distant).
- Attendez la fin du déploiement ; vérifiez les messages dans la fenêtre **Sortie** pour confirmer le succès.

### 4. Tester une première requête au niveau de SSMS

- Ouvrez **SSMS** et connectez-vous au serveur **SSAS** (type de serveur : Analysis Services).
- Dans l'**Explorateur d'objets**, naviguez vers la base de données déployée.
- Cliquez droit sur la base et sélectionnez **Nouvelle requête** > **MDX** (ou utilisez DAX via une requête XMLA).
- Entrez et exécutez cette requête DAX pour tester :  
  
  ```
  EVALUATE
  SUMMARIZECOLUMNS(
      'DimDate'[CalendarYear],
      "Net Income", [Net Income]
  )
  ```
- Vérifiez les résultats pour voir la mesure **Net Income** agrégée par la hiérarchie.

> Une hierarchie ne  peut pas être utilisée directement dans le DAX contrairement à l'hierarchie dans MDX  

#### Pour remplacer l'effet de herarchie il faut faire la requeête suivante:

**SUMMARIZECOLUMNS** est une fonction DAX qui crée une table agrégée, similaire à un tableau croisé dynamique.

```dax
EVALUATE
SUMMARIZECOLUMNS(
    'DimDate'[CalendarYear],
    'DimDate'[CalendarQuarter],
    'DimDate'[FrenchMonthName],
    "Net Income", [Net Income]
)
ORDER BY 'DimDate'[CalendarYear] DESC, 
'DimDate'[CalendarQuarter], 'DimDate'[FrenchMonthName]
```

## Section 2 : Scénario pour créer, traiter et tester une colonne calculée

**Scénario :** Vous analysez les marges des produits. Créez une colonne calculée dans **DimProduct** pour classer les produits en "Haut de gamme" si le **ListPrice** > 1000, sinon "Standard". Traitez le modèle et testez dans SSMS.

### Étape 1 : Créer la colonne calculée

- Dans **SSDT**, sélectionnez **DimProduct** dans l'**Explorateur de modèles**.
- Dans la vue **Grille**, ajoutez une nouvelle colonne.
- Dans la barre de formule, entrez :  
  **Product Class := IF(DimProduct[ListPrice] > 1000, "Haut de gamme", "Standard")**
- **Enregistrez** les modifications.

### Étape 2 : Traiter le modèle

- Cliquez droit sur la table **DimProduct** dans l'**Explorateur de modèles** et sélectionnez **Traiter** > **Traiter la table**.
- Choisissez **Traiter par défaut** et exécutez.
- Vérifiez la fenêtre **Sortie** pour confirmer le traitement sans erreurs.

### Étape 3 : Tester la colonne calculée dans SSMS avec une requête DAX

- Dans **SSMS**, connectez-vous au modèle déployé.
- Exécutez cette requête DAX :  
  
  ```
  EVALUATE
  SUMMARIZECOLUMNS(
      'DimProduct'[Product Class],
      "Count Products", COUNTROWS(DimProduct)
  )
  ```
- Analysez les résultats pour voir le comptage des produits par classe.

## Section 3 : Création d'une table calculée à partir des trois tables

**Objectif :** Créer une table calculée combinant **DimProduct**, **DimProductSubcategory** et **DimProductCategory** pour une vue unifiée des produits avec noms, puis établir une relation avec **FactInternetSales**.

### 1. Créer la table calculée

- Dans **SSDT**, dans l'**Explorateur de modèles**, cliquez droit et sélectionnez **Nouvelle table calculée**.
- Dans la barre des tables en bas cliquer créer une nouvelle table calculée et, entrez :  
  **ProductHierarchy =  
  
      SUMMARIZECOLUMNS(
          DimProduct[ProductKey],
          DimProduct[EnglishProductName],
          DimProductSubcategory[EnglishProductSubcategoryName],
          DimProductCategory[EnglishProductCategoryName]
      )
  
  cliquez droit souris et renommez la table **DimProductSummrized** sauvegarder le bim
- Passer à la vue model et visualisez la table nouvellement crée 
  
  

### 2. Établir la relation avec FactInternetSales

- Dans l'exploateur de solution cliquez droit souris sur le dossier **Relations**
- Configrer une relation entre  **DimProductSummrized** et **FactInternetSales**
- 


