### Créer des KPI dans SSDT pour un Modèle Tabular

Ce didacticiel montre comment créer des mesures et des KPI dans **SQL Server Data Tools (SSDT)** pour un projet Tabular basé sur le modèle AdventureWorksDW2022. Utilisez **Visual Studio** avec **SSDT** installé. Ouvrez le fichier **Model.bim** en mode **Vue Grille** ou **Vue Diagramme**.

#### Étape 1 : Créer des Mesures de Base

1. Dans **Visual Studio**, ouvrez le projet Tabular.
2. Sélectionnez la table **FactInternetSales** dans l'**Explorateur de Modèles Tabular**.
3. Dans la grille de colonnes, cliquez sur une cellule vide sous les colonnes existantes.
4. Entrez les formules DAX suivantes pour préparer les KPI :
   - **Total Sales** : `Total Sales := SUM(FactInternetSales[SalesAmount])`
   - **Total Cost** : `Total Cost := SUM(FactInternetSales[TotalProductCost])`
   - **Profit** : `Profit := [Total Sales] - [Total Cost]`
   - **Sales Quantity** : `Sales Quantity := SUM(FactInternetSales[OrderQuantity])`
   - **Avg Unit Price** : `Avg Unit Price := AVERAGE(FactInternetSales[UnitPrice])`
   - **Customer Count** : `Customer Count := DISTINCTCOUNT(FactInternetSales[CustomerKey])`
   - **Discount Amount** : `Discount Amount := SUM(FactInternetSales[DiscountAmount])`
5. Cliquez sur **Traiter** > **Traiter Tout** pour valider les mesures.

#### Étape 2 : Créer un KPI Stratégique

Le KPI stratégique suit les ventes totales vs. objectif annuel.

1. Sélectionnez la mesure **Total Sales** dans la table **FactInternetSales**.
2. Cliquez droit > **Créer KPI**.
3. Dans la boîte de dialogue **KPI** :
   - **Valeur de Base** : [Total Sales]
   - **Valeur Cible** : Entrez une valeur fixe, par ex. `10000000` (ou une mesure calculée comme `CALCULATE([Total Sales], PREVIOUSYEAR(DimDate[FullDateAlternateKey])) * 1.1` pour +10% sur l'année précédente).
   - **Seuil de Statut** : Choisissez **Icône** (vert/jaune/rouge) avec seuils : Vert > 1, Jaune 0.9-1, Rouge < 0.9.
4. Cliquez sur **OK**. Le KPI apparaît avec un indicateur de statut.

#### Étape 3 : Créer Deux KPI Tactiques

Ces KPI tactiques mesurent la marge bénéficiaire et les ventes par territoire.

1. Sélectionnez la mesure **Profit**.
2. Cliquez droit > **Créer KPI**.
3. Dans la boîte de dialogue **KPI** :
   - **Valeur de Base** : [Profit]
   - **Valeur Cible** : `5000000` (ou ` [Total Sales] * 0.4` pour 40% de marge).
   - **Seuil de Statut** : Vert > 1, Jaune 0.8-1, Rouge < 0.8.
4. Cliquez sur **OK**.
5. Sélectionnez **Total Sales** (filtré par territoire via relation avec DimSalesTerritory).
6. Cliquez droit > **Créer KPI** (nommez-le **Sales by Territory**).
7. Dans la boîte de dialogue **KPI** :
   - **Valeur de Base** : [Total Sales]
   - **Valeur Cible** : `2000000` par territoire.
   - **Seuil de Statut** : Vert > 1, Jaune 0.95-1, Rouge < 0.95.
8. Cliquez sur **OK**.

#### Étape 4 : Créer Quatre KPI Opérationnels

Ces KPI opérationnels suivent les quantités, prix, clients et remises.

1. Sélectionnez **Sales Quantity**.
2. Cliquez droit > **Créer KPI**.
3. Dans la boîte de dialogue **KPI** :
   - **Valeur de Base** : [Sales Quantity]
   - **Valeur Cible** : `50000`.
   - **Seuil de Statut** : Vert > 1, Jaune 0.9-1, Rouge < 0.9.
4. Cliquez sur **OK**.
5. Sélectionnez **Avg Unit Price**.
6. Cliquez droit > **Créer KPI**.
7. Dans la boîte de dialogue **KPI** :
   - **Valeur de Base** : [Avg Unit Price]
   - **Valeur Cible** : `100`.
   - **Seuil de Statut** : Vert > 1, Jaune 0.95-1, Rouge < 0.95.
8. Cliquez sur **OK**.
9. Sélectionnez **Customer Count**.
10. Cliquez droit > **Créer KPI**.
11. Dans la boîte de dialogue **KPI** :
    - **Valeur de Base** : [Customer Count]
    - **Valeur Cible** : `10000`.
    - **Seuil de Statut** : Vert > 1, Jaune 0.9-1, Rouge < 0.9.
12. Cliquez sur **OK**.
13. Sélectionnez **Discount Amount**.
14. Cliquez droit > **Créer KPI**.
15. Dans la boîte de dialogue **KPI** :
    - **Valeur de Base** : [Discount Amount]
    - **Valeur Cible** : `100000` (objectif max pour contrôle).
    - **Seuil de Statut** : Vert < 1 (inversé pour alerte sur excès), Jaune 1-1.1, Rouge > 1.1.
16. Cliquez sur **OK**.

#### Étape 5 : Utiliser les KPI

1. **Déployez** le modèle sur un serveur **Analysis Services** via **Déployer** > **Déployer la Solution**.
2. Ouvrez **Excel** ou **Power BI Desktop**.
3. Connectez-vous au modèle Tabular (via **Obtenir des Données** > **Analysis Services**).
4. Dans un **Tableau Croisé Dynamique**, ajoutez les KPI :
   - Glissez un KPI (ex. **Total Sales KPI**) dans **Valeurs**.
   - Il affiche **Valeur**, **Statut** (icône) et **Cible**.
5. Filtrez par dimensions (ex. DimDate[CalendarYear], DimProduct[EnglishProductName]) pour analyser.
6. Dans **Power BI**, utilisez des visuels **KPI** ou **Carte** pour afficher les indicateurs de statut en temps réel.
