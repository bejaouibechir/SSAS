# Atelier 3 : Time Intelligence Pratique

## AdventureWorksDW2022 - Ma√Ætriser les Analyses Temporelles

---

## Introduction

Cet atelier est consacr√© √† la **Time Intelligence** dans DAX, l'une des capacit√©s les plus puissantes pour l'analyse de donn√©es temporelles. Vous apprendrez √† manipuler les dates, comparer des p√©riodes, calculer des tendances et cr√©er des analyses sophistiqu√©es.

### Pr√©requis

Avant de commencer cet atelier, assurez-vous d'avoir :

- Compl√©t√© les Ateliers 1 et 2
- Une bonne compr√©hension de CALCULATE et des contextes
- Le mod√®le AdventureWorksDW2022 avec une table DimDate compl√®te

### Objectifs de l'Atelier

√Ä la fin de cet atelier, vous serez capable de :

- Manipuler les dates avec les fonctions de base (DATEADD, DATEDIFF, etc.)
- Cr√©er des comparaisons temporelles (N-1, variations %)
- Calculer des cumuls (YTD, QTD, MTD)
- Construire des analyses de tendances avanc√©es
- Cr√©er des dashboards comparatifs temporels professionnels

### Architecture de la Table DimDate

Une table **DimDate** bien construite est essentielle pour la Time Intelligence :

**Colonnes cl√©s** :

- **DateKey** (Integer) : Cl√© primaire au format YYYYMMDD
- **FullDateAlternateKey** (Date) : Date compl√®te (utilis√©e par les fonctions Time Intelligence)
- **CalendarYear** (Integer) : Ann√©e (ex: 2013)
- **CalendarQuarter** (Integer) : Trimestre (1-4)
- **MonthNumberOfYear** (Integer) : Mois (1-12)
- **EnglishMonthName** (String) : Nom du mois
- **DayNumberOfMonth** (Integer) : Jour du mois (1-31)
- **DayNumberOfWeek** (Integer) : Jour de la semaine (1-7)

**V√©rification** : Assurez-vous que DimDate couvre toute la p√©riode de vos donn√©es (2010-2014 pour AdventureWorksDW2022).

---

## Partie 1 : Fondamentaux des Manipulations de Dates

### 1.1 Fonctions de Base - Extraction de Parties de Date

Les fonctions **YEAR**, **MONTH**, **DAY** extraient des composants d'une date.

#### Walkthrough 1.1 : Extraire les Composants de Date

1. **Cr√©ez des colonnes calcul√©es dans DimDate** (pour d√©monstration) :



```dax
// Ann√©e (si pas d√©j√† pr√©sente)
Ann√©e Extraite = YEAR(DimDate[FullDateAlternateKey])

// Mois num√©rique
Mois Num√©rique = MONTH(DimDate[FullDateAlternateKey])

// Jour
Jour du Mois = DAY(DimDate[FullDateAlternateKey])

// Jour de la semaine (1 = Dimanche, 7 = Samedi)
Jour Semaine = WEEKDAY(DimDate[FullDateAlternateKey])

// Num√©ro de semaine
Semaine de l'Ann√©e = WEEKNUM(DimDate[FullDateAlternateKey])
```



2. **Utilisation dans les mesures** : Ces fonctions sont plus utiles dans les mesures

```dax
Ann√©e Actuelle = 
VAR CurrentDate = MAX(DimDate[FullDateAlternateKey])
RETURN YEAR(CurrentDate)

Mois Actuel = 
VAR CurrentDate = MAX(DimDate[FullDateAlternateKey])
RETURN FORMAT(CurrentDate, "MMMM yyyy")
```

3. **Testez** : Cr√©ez une carte avec ces mesures et ajoutez un segment sur les dates

#### Walkthrough 1.2 : Fonctions de Date Compl√©mentaires

1. **TODAY()** et **NOW()** :

```dax
// Date du jour (sans heure)
Date Aujourd'hui = TODAY()

// Date et heure actuelles
Date Heure Maintenant = NOW()

// Diff√©rence avec aujourd'hui
Jours Depuis Aujourd'hui = 
DATEDIFF(MAX(DimDate[FullDateAlternateKey]), TODAY(), DAY)
```

2. **‚ö†Ô∏è Important** : Ces fonctions retournent la date syst√®me au moment du rafra√Æchissement
   
   - Utiles pour des calculs "depuis aujourd'hui"
   - Se mettent √† jour √† chaque rafra√Æchissement du mod√®le

3. **EOMONTH()** - Fin de mois :

```dax
// Dernier jour du mois
Fin du Mois = 
EOMONTH(DimDate[FullDateAlternateKey], 0)

// Dernier jour du mois prochain
Fin Mois Prochain = 
EOMONTH(DimDate[FullDateAlternateKey], 1)

// Dernier jour du mois pr√©c√©dent
Fin Mois Pr√©c√©dent = 
EOMONTH(DimDate[FullDateAlternateKey], -1)
```

4. **Testez** : V√©rifiez que EOMONTH retourne toujours le 31, 30, 28/29 selon le mois

### 1.2 DATEDIFF - Calculer les √âcarts entre Dates

**DATEDIFF** calcule la diff√©rence entre deux dates dans une unit√© sp√©cifi√©e.

#### Syntaxe

```dax
DATEDIFF(<date_d√©but>, <date_fin>, <unit√©>)
```

**Unit√©s disponibles** : YEAR, QUARTER, MONTH, DAY, HOUR, MINUTE, SECOND

#### Walkthrough 1.3 : Calculs de Dur√©e

1. **√Çge d'un client en ann√©es** :

```dax
√Çge Client = 
DATEDIFF(
    MAX(DimCustomer[BirthDate]),
    TODAY(),
    YEAR
)
```

2. **Anciennet√© client en mois** :

```dax
Anciennet√© Client (Mois) = 
DATEDIFF(
    MAX(DimCustomer[DateFirstPurchase]),
    TODAY(),
    MONTH
)
```

3. **D√©lai de livraison en jours** (d√©j√† vu dans Atelier 2) :

```dax
D√©lai Livraison = 
AVERAGEX(
    FactInternetSales,
    DATEDIFF(
        FactInternetSales[OrderDate],
        FactInternetSales[ShipDate],
        DAY
    )
)
```

4. **‚ö†Ô∏è Attention aux pi√®ges** :

```dax
// ‚ùå ERREUR : DATEDIFF en ann√©es compte les changements d'ann√©e, pas les ann√©es compl√®tes
// Du 31/12/2012 au 01/01/2013 = 1 an selon DATEDIFF !

// ‚úÖ CORRECT : Pour un √¢ge pr√©cis
√Çge Pr√©cis = 
VAR BirthDate = MAX(DimCustomer[BirthDate])
VAR TodayDate = TODAY()
VAR YearDiff = YEAR(TodayDate) - YEAR(BirthDate)
VAR BirthdayPassed = 
    (MONTH(TodayDate) > MONTH(BirthDate)) ||
    (MONTH(TodayDate) = MONTH(BirthDate) && DAY(TodayDate) >= DAY(BirthDate))
RETURN
    IF(BirthdayPassed, YearDiff, YearDiff - 1)
```

5. **Testez** : Comparez les deux m√©thodes avec une date de naissance du 15/12/1990

#### Walkthrough 1.4 : Cat√©gorisation par √Çge de Donn√©es

1. **Objectif** : Classer les ventes selon leur anciennet√©

```dax
Cat√©gorie Anciennet√© Vente = 
VAR DaysOld = 
    DATEDIFF(
        MAX(FactInternetSales[OrderDate]),
        TODAY(),
        DAY
    )
RETURN
    SWITCH(
        TRUE(),
        DaysOld <= 30, "Moins de 1 mois",
        DaysOld <= 90, "1-3 mois",
        DaysOld <= 365, "3-12 mois",
        DaysOld <= 730, "1-2 ans",
        "Plus de 2 ans"
    )
```

2. **Nombre de ventes par cat√©gorie** :

```dax
Ventes par Anciennet√© = 
CALCULATE(
    COUNTROWS(FactInternetSales),
    FILTER(
        ALL(FactInternetSales),
        VAR DaysOld = DATEDIFF(FactInternetSales[OrderDate], TODAY(), DAY)
        RETURN
            SWITCH(
                TRUE(),
                DaysOld <= 30, [Cat√©gorie Anciennet√© Vente] = "Moins de 1 mois",
                DaysOld <= 90, [Cat√©gorie Anciennet√© Vente] = "1-3 mois",
                TRUE(), TRUE()
            )
    )
)
```

### 1.3 DATEADD - D√©caler les Dates

**DATEADD** d√©cale une colonne de dates d'un nombre sp√©cifi√© de p√©riodes.

#### Syntaxe

```dax
DATEADD(<dates>, <nombre_p√©riodes>, <unit√©>)
```

**Unit√©s** : YEAR, QUARTER, MONTH, DAY

#### Walkthrough 1.5 : Comparaisons Temporelles avec DATEADD

1. **Ventes du mois pr√©c√©dent** :

```dax
Ventes Mois Pr√©c√©dent = 
CALCULATE(
    SUM(FactInternetSales[SalesAmount]),
    DATEADD(DimDate[FullDateAlternateKey], -1, MONTH)
)
```

2. **M√©canisme d√©taill√©** :
   
   - **DATEADD** d√©cale toutes les dates du contexte de 1 mois en arri√®re
   - Si vous √™tes en Mars 2013, DATEADD retourne F√©vrier 2013
   - **CALCULATE** applique ce nouveau filtre de dates
   - R√©sultat : les ventes de F√©vrier 2013

3. **Ventes de l'ann√©e pr√©c√©dente** :

```dax
Ventes Ann√©e Pr√©c√©dente (DATEADD) = 
CALCULATE(
    SUM(FactInternetSales[SalesAmount]),
    DATEADD(DimDate[FullDateAlternateKey], -1, YEAR)
)
```

4. **Ventes du trimestre suivant** :

```dax
Ventes Trimestre Suivant = 
CALCULATE(
    SUM(FactInternetSales[SalesAmount]),
    DATEADD(DimDate[FullDateAlternateKey], 1, QUARTER)
)
```

5. **‚ö†Ô∏è DATEADD vs PARALLELPERIOD** :

```dax
// DATEADD d√©cale les dates exactement
Ventes DATEADD = 
CALCULATE(
    [Ventes Totales],
    DATEADD(DimDate[FullDateAlternateKey], -1, YEAR)
)

// PARALLELPERIOD retourne la p√©riode COMPL√àTE
Ventes PARALLELPERIOD = 
CALCULATE(
    [Ventes Totales],
    PARALLELPERIOD(DimDate[FullDateAlternateKey], -1, YEAR)
)
```

6. **Exemple de diff√©rence** :
   
   - Vous analysez Janvier-Mars 2013
   - **DATEADD(-1, YEAR)** : Janvier-Mars 2012 ‚úÖ
   - **PARALLELPERIOD(-1, YEAR)** : Toute l'ann√©e 2012 ‚ö†Ô∏è

7. **Testez** : Cr√©ez une matrice avec CalendarYear, les deux mesures, et observez la diff√©rence

### 1.4 SAMEPERIODLASTYEAR - Raccourci pour N-1

**SAMEPERIODLASTYEAR** est un raccourci pour `DATEADD(..., -1, YEAR)`.

#### Walkthrough 1.6 : Ann√©e Pr√©c√©dente Simplifi√©e

1. **Syntaxe √©quivalente** :

```dax
// M√©thode 1 : DATEADD
Ventes N-1 (DATEADD) = 
CALCULATE(
    [Ventes Totales],
    DATEADD(DimDate[FullDateAlternateKey], -1, YEAR)
)

// M√©thode 2 : SAMEPERIODLASTYEAR (identique)
Ventes N-1 (SPLY) = 
CALCULATE(
    [Ventes Totales],
    SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
)
```

2. **Avantage** : Code plus lisible, intention claire

3. **V√©rification** : Les deux mesures retournent exactement les m√™mes r√©sultats

4. **‚ö†Ô∏è Limitation** : Fonctionne uniquement pour les ann√©es (pas de SAMEPERIODLASTQUARTER)

### 1.5 Comparaison de P√©riodes Personnalis√©es

#### Walkthrough 1.7 : Comparer avec une P√©riode Fixe

1. **Objectif** : Comparer les ventes actuelles avec une p√©riode de r√©f√©rence (ex: 2012)

```dax
Ventes 2012 (R√©f√©rence) = 
CALCULATE(
    [Ventes Totales],
    DimDate[CalendarYear] = 2012
)
```

2. **Variation vs 2012** :

```dax
√âcart vs 2012 = 
[Ventes Totales] - [Ventes 2012 (R√©f√©rence)]

% Variation vs 2012 = 
DIVIDE(
    [√âcart vs 2012],
    [Ventes 2012 (R√©f√©rence)]
)
```

3. **Testez** : Ajoutez CalendarYear en ligne et les mesures en valeurs

4. **Comparaison avec une date sp√©cifique** :

```dax
Ventes M√™me Jour Ann√©e Pr√©c√©dente = 
VAR CurrentDate = MAX(DimDate[FullDateAlternateKey])
VAR LastYearDate = DATE(YEAR(CurrentDate) - 1, MONTH(CurrentDate), DAY(CurrentDate))
RETURN
    CALCULATE(
        [Ventes Totales],
        DimDate[FullDateAlternateKey] = LastYearDate
    )
```

5. **‚ö†Ô∏è Gestion du 29 f√©vrier** :

```dax
Ventes M√™me Jour N-1 (Robuste) = 
VAR CurrentDate = MAX(DimDate[FullDateAlternateKey])
VAR CurrentYear = YEAR(CurrentDate)
VAR CurrentMonth = MONTH(CurrentDate)
VAR CurrentDay = DAY(CurrentDate)
VAR LastYearDate = 
    IF(
        CurrentMonth = 2 && CurrentDay = 29,
        DATE(CurrentYear - 1, 2, 28),  // 29 f√©v ‚Üí 28 f√©v ann√©e pr√©c√©dente
        DATE(CurrentYear - 1, CurrentMonth, CurrentDay)
    )
RETURN
    CALCULATE(
        [Ventes Totales],
        DimDate[FullDateAlternateKey] = LastYearDate
    )
```

---

## Partie 2 : Cumuls et Analyses √† Date (YTD, QTD, MTD)

### 2.1 Concepts des Cumuls

**Cumul** (Year-to-Date, Quarter-to-Date, etc.) : somme depuis le d√©but d'une p√©riode jusqu'√† la date actuelle dans le contexte.

**Exemple YTD** :

- Au 31 Mars 2013 : somme de Janvier + F√©vrier + Mars 2013
- Au 30 Juin 2013 : somme de Janvier √† Juin 2013
- Au 1er Janvier 2014 : uniquement Janvier 2014 (red√©marre)

### 2.2 DATESYTD - Year-to-Date

#### Walkthrough 2.1 : Ventes Cumul√©es depuis D√©but d'Ann√©e

1. **Syntaxe de base** :

```dax
Ventes YTD = 
CALCULATE(
    [Ventes Totales],
    DATESYTD(DimDate[FullDateAlternateKey])
)
```

2. **M√©canisme** :
   
   - **DATESYTD** retourne toutes les dates depuis le 1er janvier de l'ann√©e en cours jusqu'√† la date max du contexte
   - **CALCULATE** applique ce filtre de dates
   - R√©sultat : cumul depuis janvier

3. **Testez dans une matrice** :
   
   - Lignes : CalendarYear, EnglishMonthName
   - Valeurs : [Ventes Totales], [Ventes YTD]

4. **R√©sultat attendu** :

| Ann√©e | Mois     | Ventes Totales | Ventes YTD          |
| ----- | -------- | -------------- | ------------------- |
| 2013  | January  | 500,000        | 500,000             |
| 2013  | February | 600,000        | 1,100,000           |
| 2013  | March    | 700,000        | 1,800,000           |
| ...   | ...      | ...            | ...                 |
| 2014  | January  | 550,000        | 550,000 (red√©marre) |

5. **Ann√©e fiscale personnalis√©e** :

```dax
Ventes YTD Fiscal = 
CALCULATE(
    [Ventes Totales],
    DATESYTD(DimDate[FullDateAlternateKey], "06-30")
)
```

**Explication** : "06-30" indique que l'ann√©e fiscale se termine le 30 juin (donc commence le 1er juillet)

6. **Testez** : Comparez avec CalendarYear pour voir le cumul red√©marrer en juillet

### 2.3 DATESQTD et DATESMTD - Cumuls Trimestriels et Mensuels

#### Walkthrough 2.2 : Cumuls Multi-P√©riodes

1. **Quarter-to-Date (QTD)** :

```dax
Ventes QTD = 
CALCULATE(
    [Ventes Totales],
    DATESQTD(DimDate[FullDateAlternateKey])
)
```

2. **Month-to-Date (MTD)** :

```dax
Ventes MTD = 
CALCULATE(
    [Ventes Totales],
    DATESMTD(DimDate[FullDateAlternateKey])
)
```

3. **Testez dans une matrice** :
   
   - Lignes : CalendarYear, CalendarQuarter, EnglishMonthName, DayNumberOfMonth
   - Valeurs : [Ventes Totales], [Ventes MTD], [Ventes QTD], [Ventes YTD]

4. **Observation** :
   
   - **MTD** red√©marre le 1er de chaque mois
   - **QTD** red√©marre le 1er du 1er mois de chaque trimestre (Jan, Apr, Jul, Oct)
   - **YTD** red√©marre le 1er janvier

5. **Cumul personnalis√© - Last 30 Days** :

```dax
Ventes 30 Derniers Jours = 
CALCULATE(
    [Ventes Totales],
    DATESINPERIOD(
        DimDate[FullDateAlternateKey],
        MAX(DimDate[FullDateAlternateKey]),
        -30,
        DAY
    )
)
```

6. **Diff√©rence avec MTD** :
   - **MTD** : du 1er du mois √† aujourd'hui (red√©marre chaque mois)
   - **30 derniers jours** : fen√™tre glissante de 30 jours (ne red√©marre pas)

### 2.4 TOTALYTD, TOTALQTD, TOTALMTD - Cumuls avec Expression

Les fonctions **TOTALYTD/QTD/MTD** permettent de calculer des cumuls sur des expressions complexes.

#### Walkthrough 2.3 : Cumuls sur Mesures Calcul√©es

1. **Diff√©rence entre DATESYTD et TOTALYTD** :

```dax
// M√©thode 1 : DATESYTD (plus courante)
Ventes YTD v1 = 
CALCULATE(
    [Ventes Totales],
    DATESYTD(DimDate[FullDateAlternateKey])
)

// M√©thode 2 : TOTALYTD (√©quivalente pour SUM)
Ventes YTD v2 = 
TOTALYTD(
    SUM(FactInternetSales[SalesAmount]),
    DimDate[FullDateAlternateKey]
)
```

2. **Quand utiliser TOTALYTD ?** Quand vous avez besoin d'un filtre suppl√©mentaire :

```dax
// Cumul YTD des ventes en ligne uniquement
Ventes YTD En Ligne = 
TOTALYTD(
    SUM(FactInternetSales[SalesAmount]),
    DimDate[FullDateAlternateKey],
    ALL(DimCustomer),  // Filtre additionnel
    "12-31"  // Fin d'ann√©e fiscale
)
```

3. **‚ö†Ô∏è Limitation** : TOTALYTD √©value l'expression dans le contexte de filtre, mais ne peut pas utiliser d'autres mesures

```dax
// ‚ùå NE FONCTIONNE PAS
Marge YTD (ERREUR) = 
TOTALYTD(
    [Marge Totale],  // Mesure non accept√©e
    DimDate[FullDateAlternateKey]
)

// ‚úÖ SOLUTION
Marge YTD = 
CALCULATE(
    [Marge Totale],
    DATESYTD(DimDate[FullDateAlternateKey])
)
```

### 2.5 Cumuls Comparatifs

#### Walkthrough 2.4 : Comparer YTD N vs YTD N-1

1. **YTD ann√©e pr√©c√©dente** :

```dax
Ventes YTD N-1 = 
CALCULATE(
    [Ventes YTD],
    SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
)
```

2. **‚ö†Ô∏è Pi√®ge courant** : L'ordre compte !

```dax
// ‚ùå INCORRECT - SAMEPERIODLASTYEAR annule DATESYTD
Ventes YTD N-1 (ERREUR) = 
CALCULATE(
    [Ventes Totales],
    SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey]),
    DATESYTD(DimDate[FullDateAlternateKey])
)

// ‚úÖ CORRECT - YTD puis d√©calage
Ventes YTD N-1 (CORRECT) = 
CALCULATE(
    [Ventes YTD],
    SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
)

// ‚úÖ ALTERNATIVE - D√©calage puis YTD
Ventes YTD N-1 (ALT) = 
CALCULATE(
    [Ventes Totales],
    DATESYTD(
        DATEADD(DimDate[FullDateAlternateKey], -1, YEAR)
    )
)
```

3. **Variation YTD** :

```dax
Variation YTD vs N-1 = 
[Ventes YTD] - [Ventes YTD N-1]

% Variation YTD vs N-1 = 
DIVIDE(
    [Variation YTD vs N-1],
    [Ventes YTD N-1]
)
```

4. **Testez** : Matrice avec Ann√©e, Mois, et toutes ces mesures

---

## 9. Sc√©nario 7 : Dashboard Comparatif Temporel

### Objectif du Sc√©nario

Cr√©er un **dashboard interactif** permettant de comparer les performances sur diff√©rentes p√©riodes avec plusieurs indicateurs cl√©s.

### Walkthrough 7.1 : Mesures de Base pour le Dashboard

1. **Mesure de ventes de base** :

```dax
Ventes Totales = SUM(FactInternetSales[SalesAmount])
```

2. **Ensemble complet de comparaisons temporelles** :

```dax
// P√©riode pr√©c√©dente (contextuel)
Ventes P√©riode Pr√©c√©dente = 
VAR CurrentPeriod = VALUES(DimDate[FullDateAlternateKey])
VAR PeriodLength = COUNTROWS(CurrentPeriod)
RETURN
    CALCULATE(
        [Ventes Totales],
        DATESINPERIOD(
            DimDate[FullDateAlternateKey],
            MIN(DimDate[FullDateAlternateKey]) - 1,
            -PeriodLength,
            DAY
        )
    )

// M√™me p√©riode ann√©e pr√©c√©dente
Ventes N-1 = 
CALCULATE(
    [Ventes Totales],
    SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
)

// Mois pr√©c√©dent
Ventes Mois Pr√©c√©dent = 
CALCULATE(
    [Ventes Totales],
    DATEADD(DimDate[FullDateAlternateKey], -1, MONTH)
)

// Trimestre pr√©c√©dent
Ventes Trimestre Pr√©c√©dent = 
CALCULATE(
    [Ventes Totales],
    DATEADD(DimDate[FullDateAlternateKey], -1, QUARTER)
)
```

### Walkthrough 7.2 : KPIs de Performance

1. **Variations absolues** :

```dax
Œî vs P√©riode Pr√©c√©dente = 
[Ventes Totales] - [Ventes P√©riode Pr√©c√©dente]

Œî vs N-1 = 
[Ventes Totales] - [Ventes N-1]

Œî vs Mois Pr√©c√©dent = 
[Ventes Totales] - [Ventes Mois Pr√©c√©dent]
```

2. **Variations relatives** :

```dax
% Variation vs P√©riode Pr√©c√©dente = 
DIVIDE([Œî vs P√©riode Pr√©c√©dente], [Ventes P√©riode Pr√©c√©dente])

% Variation vs N-1 = 
DIVIDE([Œî vs N-1], [Ventes N-1])

% Croissance Annuelle = 
DIVIDE([Œî vs N-1], [Ventes N-1])
```

3. **Indicateurs de tendance** :

```dax
Tendance = 
SWITCH(
    TRUE(),
    [% Variation vs N-1] > 0.1, "üìà Forte croissance",
    [% Variation vs N-1] > 0, "‚ÜóÔ∏è Croissance",
    [% Variation vs N-1] > -0.1, "‚Üí Stable",
    "üìâ D√©croissance"
)
```

### Walkthrough 7.3 : Cartes KPI Dynamiques

1. **Titre dynamique de carte** :

```dax
Titre P√©riode S√©lectionn√©e = 
VAR MinDate = MIN(DimDate[FullDateAlternateKey])
VAR MaxDate = MAX(DimDate[FullDateAlternateKey])
RETURN
    IF(
        MinDate = MaxDate,
        FORMAT(MinDate, "DD MMMM YYYY"),
        FORMAT(MinDate, "DD MMM") & " - " & FORMAT(MaxDate, "DD MMM YYYY")
    )
```

2. **Valeur avec indicateur visuel** :

```dax
Ventes avec Indicateur = 
VAR Sales = [Ventes Totales]
VAR Growth = [% Variation vs N-1]
VAR Arrow = 
    SWITCH(
        TRUE(),
        Growth > 0, "‚ñ≤",
        Growth < 0, "‚ñº",
        "‚óè"
    )
RETURN
    FORMAT(Sales, "$ #,##0") & " " & Arrow & " " & FORMAT(Growth, "+0.0%;-0.0%")
```

3. **Configuration de la carte KPI** :
   - **Champ** : Ventes Totales
   - **Objectif** : Ventes N-1
   - **Indicateur de tendance** : % Variation vs N-1
   - **Direction** : High is good

### Walkthrough 7.4 : Graphique Comparatif Multi-P√©riodes

1. **Table de comparaison** :

```dax
// Table calcul√©e pour le visuel
Comparaison Temporelle = 
UNION(
    ROW("P√©riode", "Actuelle", "Ventes", [Ventes Totales]),
    ROW("P√©riode", "P√©riode Pr√©c√©dente", "Ventes", [Ventes P√©riode Pr√©c√©dente]),
    ROW("P√©riode", "M√™me P√©riode N-1", "Ventes", [Ventes N-1]),
    ROW("P√©riode", "Mois Pr√©c√©dent", "Ventes", [Ventes Mois Pr√©c√©dent])
)
```

2. **Alternative avec mesures dynamiques** :

```dax
Ventes par Type P√©riode = 
VAR SelectedPeriod = SELECTEDVALUE('Type P√©riode'[P√©riode])
RETURN
    SWITCH(
        SelectedPeriod,
        "Actuelle", [Ventes Totales],
        "P√©riode Pr√©c√©dente", [Ventes P√©riode Pr√©c√©dente],
        "N-1", [Ventes N-1],
        "Mois Pr√©c√©dent", [Ventes Mois Pr√©c√©dent],
        BLANK()
    )
```

3. **Cr√©ez un graphique en barres** :
   - Axe X : Type P√©riode[P√©riode]
   - Axe Y : [Ventes par Type P√©riode]
   - Mise en forme conditionnelle bas√©e sur la variation

### Walkthrough 7.5 : Graphique d'√âvolution avec Bandes de R√©f√©rence

1. **Moyenne mobile sur 3 mois** :

```dax
Moyenne Mobile 3 Mois = 
AVERAGEX(
    DATESINPERIOD(
        DimDate[FullDateAlternateKey],
        MAX(DimDate[FullDateAlternateKey]),
        -3,
        MONTH
    ),
    [Ventes Totales]
)
```

2. **Bandes de r√©f√©rence** :

```dax
// Bande haute (moyenne + 10%)
Bande Haute = [Moyenne Mobile 3 Mois] * 1.1

// Bande basse (moyenne - 10%)
Bande Basse = [Moyenne Mobile 3 Mois] * 0.9
```

3. **Graphique en courbes** :
   - Axe X : DimDate[FullDateAlternateKey]
   - Valeurs : [Ventes Totales], [Moyenne Mobile 3 Mois], [Bande Haute], [Bande Basse]
   - Type de ligne : Pleine pour Ventes, Pointill√©e pour les bandes

### Walkthrough 7.6 : Table de Scorecard Multi-Indicateurs

1. **Cr√©ez une table de m√©triques** :

```dax
// Table calcul√©e
M√©triques = 
DATATABLE(
    "M√©trique", STRING,
    "Ordre", INTEGER,
    {
        {"Ventes", 1},
        {"Quantit√©", 2},
        {"Marge", 3},
        {"Nombre Clients", 4}
    }
)
```

2. **Mesure dynamique bas√©e sur la s√©lection** :

```dax
Valeur Actuelle = 
VAR SelectedMetric = SELECTEDVALUE(M√©triques[M√©trique])
RETURN
    SWITCH(
        SelectedMetric,
        "Ventes", [Ventes Totales],
        "Quantit√©", SUM(FactInternetSales[OrderQuantity]),
        "Marge", [Marge Totale],
        "Nombre Clients", DISTINCTCOUNT(FactInternetSales[CustomerKey]),
        BLANK()
    )

Valeur N-1 = 
VAR SelectedMetric = SELECTEDVALUE(M√©triques[M√©trique])
RETURN
    CALCULATE(
        [Valeur Actuelle],
        SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
    )

% Variation M√©trique = 
DIVIDE([Valeur Actuelle] - [Valeur N-1], [Valeur N-1])
```

3. **Cr√©ez une matrice** :
   - Lignes : M√©triques[M√©trique]
   - Valeurs : [Valeur Actuelle], [Valeur N-1], [% Variation M√©trique]
   - Mise en forme conditionnelle sur % Variation

### Walkthrough 7.7 : S√©lecteur de P√©riode Dynamique

1. **Table de s√©lection de p√©riodes** :

```dax
S√©lecteur P√©riode = 
DATATABLE(
    "Type Comparaison", STRING,
    "Jours", INTEGER,
    {
        {"Jour", 1},
        {"Semaine", 7},
        {"Mois", 30},
        {"Trimestre", 90},
        {"Ann√©e", 365}
    }
)
```

2. **Mesure avec p√©riode dynamique** :

```dax
Ventes P√©riode S√©lectionn√©e = 
VAR DaysBack = SELECTEDVALUE('S√©lecteur P√©riode'[Jours], 30)
RETURN
    CALCULATE(
        [Ventes Totales],
        DATESINPERIOD(
            DimDate[FullDateAlternateKey],
            MAX(DimDate[FullDateAlternateKey]),
            -DaysBack,
            DAY
        )
    )
```

3. **Ajoutez un slicer** sur Type Comparaison et observez les m√©triques s'adapter

---

## 10. Sc√©nario 8 : Analyse de Tendances YTD/QTD

### Objectif du Sc√©nario

Construire des analyses sophistiqu√©es de cumuls avec comparaisons multi-p√©riodes et d√©tection de tendances.

### Walkthrough 8.1 : Suite Compl√®te de Mesures YTD

1. **YTD ann√©e actuelle** :

```dax
Ventes YTD = 
CALCULATE(
    [Ventes Totales],
    DATESYTD(DimDate[FullDateAlternateKey])
)
```

2. **YTD ann√©e pr√©c√©dente** :

```dax
Ventes YTD N-1 = 
CALCULATE(
    [Ventes YTD],
    SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
)
```

3. **Variation YTD** :

```dax
Œî YTD vs N-1 = 
[Ventes YTD] - [Ventes YTD N-1]

% Croissance YTD = 
DIVIDE([Œî YTD vs N-1], [Ventes YTD N-1])
```

4. **YTD il y a 2 ans** (pour tendance sur 3 ans) :

```dax
Ventes YTD N-2 = 
CALCULATE(
    [Ventes YTD],
    DATEADD(DimDate[FullDateAlternateKey], -2, YEAR)
)

CAGR YTD (2 ans) = 
VAR CurrentYTD = [Ventes YTD]
VAR YTD2YearsAgo = [Ventes YTD N-2]
RETURN
    POWER(DIVIDE(CurrentYTD, YTD2YearsAgo), 1/2) - 1
```

### Walkthrough 8.2 : Analyse QTD avec D√©composition

1. **Suite QTD compl√®te** :

```dax
Ventes QTD = 
CALCULATE(
    [Ventes Totales],
    DATESQTD(DimDate[FullDateAlternateKey])
)

Ventes QTD N-1 = 
CALCULATE(
    [Ventes QTD],
    SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
)

Ventes QTD Trimestre Pr√©c√©dent = 
CALCULATE(
    [Ventes Totales],
    DATESQTD(
        DATEADD(DimDate[FullDateAlternateKey], -1, QUARTER)
    )
)
```

2. **Contribution au total annuel** :

```dax
% QTD du YTD = 
DIVIDE([Ventes QTD], [Ventes YTD])
```

3. **Projection fin d'ann√©e bas√©e sur QTD** :

```dax
Projection Ann√©e (bas√©e sur QTD) = 
VAR CurrentQuarter = MAX(DimDate[CalendarQuarter])
VAR QuartersPassed = CurrentQuarter
VAR QuartersRemaining = 4 - QuartersPassed
VAR AvgPerQuarter = DIVIDE([Ventes YTD], QuartersPassed)
RETURN
    [Ventes YTD] + (AvgPerQuarter * QuartersRemaining)
```

### Walkthrough 8.3 : MTD avec Comparaison Jour-√†-Jour

1. **MTD avec contexte** :

```dax
Ventes MTD = 
CALCULATE(
    [Ventes Totales],
    DATESMTD(DimDate[FullDateAlternateKey])
)

Ventes MTD Mois Pr√©c√©dent = 
CALCULATE(
    [Ventes MTD],
    DATEADD(DimDate[FullDateAlternateKey], -1, MONTH)
)
```

2. **Comparaison au m√™me jour du mois pr√©c√©dent** :

```dax
Ventes M√™me Jour Mois Pr√©c√©dent = 
VAR CurrentDayOfMonth = MAX(DimDate[DayNumberOfMonth])
VAR PreviousMonth = DATEADD(DimDate[FullDateAlternateKey], -1, MONTH)
RETURN
    CALCULATE(
        [Ventes Totales],
        PreviousMonth,
        DimDate[DayNumberOfMonth] = CurrentDayOfMonth
    )
```

3. **Alerte si en retard sur objectif** :

```dax
Statut MTD = 
VAR CurrentMTD = [Ventes MTD]
VAR PreviousMTD = [Ventes MTD Mois Pr√©c√©dent]
RETURN
    IF(
        CurrentMTD >= PreviousMTD,
        "‚úÖ En avance",
        "‚ö†Ô∏è En retard de " & FORMAT(ABS([% Variation MTD]), "0.0%")
    )

% Variation MTD = 
DIVIDE(
    [Ventes MTD] - [Ventes MTD Mois Pr√©c√©dent],
    [Ventes MTD Mois Pr√©c√©dent]
)
```

### Walkthrough 8.4 : Graphique de Tendance Cumul√©e

1. **Mesure pour graphique empil√© YTD** :

```dax
Contribution Mensuelle au YTD = 
VAR CurrentYearStart = DATE(YEAR(MAX(DimDate[FullDateAlternateKey])), 1, 1)
VAR CurrentMonthStart = DATE(
    YEAR(MAX(DimDate[FullDateAlternateKey])),
    MONTH(MAX(DimDate[FullDateAlternateKey])),
    1
)
RETURN
    CALCULATE(
        [Ventes Totales],
        DimDate[FullDateAlternateKey] >= CurrentMonthStart &&
        DimDate[FullDateAlternateKey] <= MAX(DimDate[FullDateAlternateKey])
    )
```

2. **Cr√©ez un graphique en colonnes empil√©es** :
   - Axe X : EnglishMonthName
   - Valeurs : [Contribution Mensuelle au YTD]
   - L√©gende : CalendarYear
   - R√©sultat : Visualisation du build-up YTD mois par mois

### Walkthrough 8.5 : Tableau de Bord YTD vs Budget

1. **Cr√©ez une table Budget** (simul√©e ici) :

```dax
// Table calcul√©e pour simulation
Budget = 
ADDCOLUMNS(
    CALENDAR(DATE(2010,1,1), DATE(2014,12,31)),
    "BudgetAmount", 
        RANDBETWEEN(10000, 50000) * (1 + WEEKNUM([Date]) / 100)
)
```

2. **Mesures budget** :

```dax
Budget Total = SUM(Budget[BudgetAmount])

Budget YTD = 
CALCULATE(
    [Budget Total],
    DATESYTD(Budget[Date])
)
```

3. **Comparaison R√©alis√© vs Budget** :

```dax
√âcart R√©alis√© vs Budget YTD = 
[Ventes YTD] - [Budget YTD]

% R√©alisation Budget YTD = 
DIVIDE([Ventes YTD], [Budget YTD])

Statut Budget = 
SWITCH(
    TRUE(),
    [% R√©alisation Budget YTD] >= 1.1, "üèÜ Largement d√©pass√©",
    [% R√©alisation Budget YTD] >= 1, "‚úÖ Objectif atteint",
    [% R√©alisation Budget YTD] >= 0.9, "‚ö†Ô∏è Proche objectif",
    "‚ùå Sous objectif"
)
```

4. **Projection pour atteindre le budget annuel** :

```dax
Ventes Mensuelles N√©cessaires = 
VAR RemainingBudget = [Budget YTD] - [Ventes YTD]
VAR CurrentMonth = MONTH(MAX(DimDate[FullDateAlternateKey]))
VAR MonthsRemaining = 12 - CurrentMonth
RETURN
    DIVIDE(RemainingBudget, MonthsRemaining)
```

### Walkthrough 8.6 : Analyse de Saisonnalit√© YTD

1. **Index de saisonnalit√©** :

```dax
Index Saisonnalit√© = 
VAR CurrentMonthSales = [Ventes Totales]
VAR AverageMonthSales = 
    CALCULATE(
        [Ventes Totales],
        ALLEXCEPT(DimDate, DimDate[MonthNumberOfYear])
    ) / DISTINCTCOUNT(DimDate[CalendarYear])
RETURN
    DIVIDE(CurrentMonthSales, AverageMonthSales)
```

2. **YTD ajust√© de la saisonnalit√©** :

```dax
Ventes YTD D√©saisonnalis√©es = 
SUMX(
    DATESYTD(DimDate[FullDateAlternateKey]),
    DIVIDE([Ventes Totales], [Index Saisonnalit√©])
)
```

3. **Testez** : Comparez YTD normal vs YTD d√©saisonnalis√© pour voir l'impact

---

## 11. Sc√©nario 9 : Croissance et Variations

### Objectif du Sc√©nario

Ma√Ætriser les calculs de croissance, variations, taux compos√©s et analyses de momentum.

### Walkthrough 9.1 : Variations Simples et Cumulatives

1. **Variation mensuelle** :

```dax
Variation Mensuelle = 
VAR CurrentMonth = [Ventes Totales]
VAR PreviousMonth = [Ventes Mois Pr√©c√©dent]
RETURN
    CurrentMonth - PreviousMonth

% Variation Mensuelle = 
DIVIDE([Variation Mensuelle], [Ventes Mois Pr√©c√©dent])
```

2. **Variation annuelle** :

```dax
Variation Annuelle = 
[Ventes Totales] - [Ventes N-1]

% Croissance Annuelle = 
DIVIDE([Variation Annuelle], [Ventes N-1])
```

3. **Variation cumulative YTD** :

```dax
Variation Cumulative YTD = 
[Ventes YTD] - [Ventes YTD N-1]

% Variation Cumulative YTD = 
DIVIDE([Variation Cumulative YTD], [Ventes YTD N-1])
```

### Walkthrough 9.2 : CAGR (Taux de Croissance Annuel Compos√©)

1. **CAGR sur p√©riode compl√®te** :

```dax
CAGR = 
VAR FirstYear = CALCULATE([Ventes Totales], DimDate[CalendarYear] = 2011)
VAR LastYear = CALCULATE([Ventes Totales], DimDate[CalendarYear] = 2013)
VAR YearSpan = 2013 - 2011
RETURN
    POWER(DIVIDE(LastYear, FirstYear), 1/YearSpan) - 1
```

2. **Explication de la formule** :
   
   - CAGR = (Valeur Finale / Valeur Initiale)^(1/Nombre d'ann√©es) - 1
   - Exemple : Si 100K en 2011 ‚Üí 150K en 2013
   - CAGR = (150/100)^(1/2) - 1 = 1.2247 - 1 = 22.47%

3. **CAGR dynamique** (bas√© sur s√©lection) :

```dax
CAGR P√©riode S√©lectionn√©e = 
VAR MinYear = MIN(DimDate[CalendarYear])
VAR MaxYear = MAX(DimDate[CalendarYear])
VAR FirstYearSales = CALCULATE([Ventes Totales], DimDate[CalendarYear] = MinYear)
VAR LastYearSales = CALCULATE([Ventes Totales], DimDate[CalendarYear] = MaxYear)
VAR YearSpan = MaxYear - MinYear
RETURN
    IF(
        YearSpan > 0,
        POWER(DIVIDE(LastYearSales, FirstYearSales), 1/YearSpan) - 1,
        BLANK()
    )
```

4. **Testez** : Utilisez un segment sur CalendarYear et observez le CAGR s'ajuster

### Walkthrough 9.3 : Momentum et Acc√©l√©ration

1. **Momentum (croissance de la croissance)** :

```dax
Croissance Mois Actuel = 
[% Variation Mensuelle]

Croissance Mois Pr√©c√©dent = 
CALCULATE(
    [% Variation Mensuelle],
    DATEADD(DimDate[FullDateAlternateKey], -1, MONTH)
)

Momentum = 
[Croissance Mois Actuel] - [Croissance Mois Pr√©c√©dent]
```

2. **Interpr√©tation** :
   
   - Momentum > 0 : La croissance s'acc√©l√®re üìà
   - Momentum < 0 : La croissance ralentit üìâ
   - Momentum = 0 : Croissance stable ‚Üí

3. **Acc√©l√©ration sur 3 mois** :

```dax
Acc√©l√©ration 3 Mois = 
VAR Growth1 = [% Variation Mensuelle]
VAR Growth2 = CALCULATE([% Variation Mensuelle], DATEADD(DimDate[FullDateAlternateKey], -1, MONTH))
VAR Growth3 = CALCULATE([% Variation Mensuelle], DATEADD(DimDate[FullDateAlternateKey], -2, MONTH))
RETURN
    (Growth1 - Growth3) / 2
```

### Walkthrough 9.4 : Analyse de Contribution √† la Croissance

1. **Contribution par produit √† la croissance totale** :

```dax
Contribution Croissance = 
VAR TotalGrowth = [Variation Annuelle]
VAR ProductGrowth = 
    [Ventes Totales] - 
    CALCULATE(
        [Ventes Totales],
        SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
    )
RETURN
    DIVIDE(ProductGrowth, TotalGrowth)
```

2. **Top contributeurs** :

```dax
Top 5 Contributeurs Croissance = 
CALCULATE(
    [Ventes Totales],
    TOPN(
        5,
        ALL(DimProduct[EnglishProductName]),
        [Contribution Croissance],
        DESC
    )
)
```

3. **Cr√©ez une matrice** :
   - Lignes : EnglishProductName
   - Valeurs : [Variation Annuelle], [Contribution Croissance]
   - Tri : Par Contribution Croissance d√©croissant

### Walkthrough 9.5 : Indice Base 100

1. **Principe** : Normaliser toutes les valeurs par rapport √† une p√©riode de r√©f√©rence = 100

```dax
Indice Base 100 (2011) = 
VAR BaseSales = CALCULATE([Ventes Totales], DimDate[CalendarYear] = 2011)
VAR CurrentSales = [Ventes Totales]
RETURN
    DIVIDE(CurrentSales, BaseSales) * 100
```

2. **Indice base 100 dynamique** :

```dax
Indice Base 100 (Premi√®re Ann√©e) = 
VAR FirstYear = MIN(DimDate[CalendarYear])
VAR BaseSales = CALCULATE([Ventes Totales], DimDate[CalendarYear] = FirstYear)
VAR CurrentSales = [Ventes Totales]
RETURN
    DIVIDE(CurrentSales, BaseSales) * 100
```

3. **Cr√©ez un graphique en courbes** :
   
   - Axe X : CalendarYear
   - Valeurs : [Indice Base 100 (Premi√®re Ann√©e)] pour plusieurs cat√©gories
   - Ligne de r√©f√©rence √† 100

4. **Interpr√©tation** :
   
   - Indice = 100 : √âgal √† l'ann√©e de base
   - Indice = 150 : 50% au-dessus de l'ann√©e de base
   - Indice = 80 : 20% en-dessous de l'ann√©e de base

### Walkthrough 9.6 : Volatilit√© et Stabilit√©

1. **√âcart-type des ventes mensuelles** :

```dax
Volatilit√© Ventes = 
VAR SalesTable = 
    ADDCOLUMNS(
        VALUES(DimDate[EnglishMonthName]),
        "MonthlySales", [Ventes Totales]
    )
RETURN
    STDEV.P([MonthlySales])
```

2. **Coefficient de variation** :

```dax
Coefficient Variation = 
DIVIDE(
    [Volatilit√© Ventes],
    AVERAGE(FactInternetSales[SalesAmount])
)
```

3. **Stabilit√© de la croissance** :

```dax
Stabilit√© Croissance = 
VAR GrowthRates = 
    ADDCOLUMNS(
        VALUES(DimDate[CalendarYear]),
        "GrowthRate", [% Croissance Annuelle]
    )
VAR AvgGrowth = AVERAGEX(GrowthRates, [GrowthRate])
VAR StdDevGrowth = STDEVX.P(GrowthRates, [GrowthRate])
RETURN
    DIVIDE(StdDevGrowth, AvgGrowth)
```

4. **Interpr√©tation** :
   - Faible coefficient de variation : Croissance stable et pr√©visible
   - √âlev√© coefficient de variation : Croissance erratique

### Walkthrough 9.7 : Graphique en Cascade (Waterfall)

1. **D√©composition de la variation annuelle** :

```dax
// Cr√©ez une table de d√©composition
D√©composition Variation = 
VAR CurrentYear = MAX(DimDate[CalendarYear])
VAR PreviousYear = CurrentYear - 1
RETURN
UNION(
    ROW(
        "Cat√©gorie", "Ann√©e " & PreviousYear,
        "Type", "D√©part",
        "Valeur", CALCULATE([Ventes Totales], DimDate[CalendarYear] = PreviousYear)
    ),
    ADDCOLUMNS(
        VALUES(DimProductCategory[EnglishProductCategoryName]),
        "Cat√©gorie", DimProductCategory[EnglishProductCategoryName],
        "Type", "Contribution",
        "Valeur", 
            CALCULATE([Ventes Totales], DimDate[CalendarYear] = CurrentYear) -
            CALCULATE([Ventes Totales], DimDate[CalendarYear] = PreviousYear)
    ),
    ROW(
        "Cat√©gorie", "Ann√©e " & CurrentYear,
        "Type", "Arriv√©e",
        "Valeur", CALCULATE([Ventes Totales], DimDate[CalendarYear] = CurrentYear)
    )
)
```

2. **Cr√©ez un graphique en cascade** :
   - Cat√©gorie : D√©composition Variation[Cat√©gorie]
   - Valeur : D√©composition Variation[Valeur]
   - Type : D√©composition Variation[Type]

### Walkthrough 9.8 : Croissance Organique vs Inorganique

1. **Contexte** : Supposons l'ajout de nouveaux produits en 2013

```dax
// Ventes de produits existants uniquement
Ventes Produits Existants = 
VAR ExistingProducts = 
    CALCULATETABLE(
        VALUES(DimProduct[ProductKey]),
        DimDate[CalendarYear] = 2012
    )
RETURN
    CALCULATE(
        [Ventes Totales],
        DimProduct[ProductKey] IN ExistingProducts
    )

// Croissance organique (produits existants)
Croissance Organique = 
VAR CurrentSales = [Ventes Produits Existants]
VAR PreviousSales = 
    CALCULATE(
        [Ventes Produits Existants],
        SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey])
    )
RETURN
    DIVIDE(CurrentSales - PreviousSales, PreviousSales)

// Croissance inorganique (nouveaux produits)
Croissance Inorganique = 
[% Croissance Annuelle] - [Croissance Organique]
```

### Walkthrough 9.9 : Analyse de Pareto des Variations

1. **Contribution cumul√©e √† la croissance** :

```dax
// Rang par contribution
Rang Contribution = 
RANKX(
    ALL(DimProduct[EnglishProductName]),
    [Contribution Croissance],
    ,
    DESC,
    DENSE
)

// Contribution cumul√©e
Contribution Cumul√©e = 
VAR CurrentRank = [Rang Contribution]
RETURN
    SUMX(
        FILTER(
            ALL(DimProduct[EnglishProductName]),
            [Rang Contribution] <= CurrentRank
        ),
        [Contribution Croissance]
    )

// Identification Pareto (80/20)
Pareto = 
IF([Contribution Cumul√©e] <= 0.8, "Top 80%", "Reste 20%")
```

2. **Cr√©ez un graphique combin√©** :
   - Axe X : EnglishProductName (tri√© par Rang Contribution)
   - Barres : [Contribution Croissance]
   - Ligne : [Contribution Cumul√©e]
   - Ligne de r√©f√©rence √† 80%

---

## Conclusion

Cet atelier vous a permis de ma√Ætriser :

‚úÖ **Manipulation de dates** : YEAR, MONTH, DAY, DATEDIFF, DATEADD  
‚úÖ **Comparaisons temporelles** : N-1, p√©riodes pr√©c√©dentes, p√©riodes parall√®les  
‚úÖ **Cumuls** : YTD, QTD, MTD avec variations  
‚úÖ **Dashboards comparatifs** : KPIs, cartes dynamiques, graphiques de tendance  
‚úÖ **Analyses de croissance** : Variations, CAGR, momentum, contribution

### Points Cl√©s √† Retenir

1. **DATEDIFF** calcule des √©carts, mais attention aux pi√®ges (ann√©es, mois)
2. **DATEADD** d√©cale les p√©riodes, **SAMEPERIODLASTYEAR** est un raccourci pour -1 an
3. **DATESYTD/QTD/MTD** cr√©ent des cumuls qui red√©marrent √† chaque p√©riode
4. **L'ordre des filtres** dans CALCULATE est crucial pour les cumuls comparatifs
5. **Variables** rendent les mesures complexes plus lisibles et performantes

### Patterns de Mesures R√©utilisables

```dax
// Template de variation
[Mesure] Variation vs [P√©riode] = 
VAR Current = [Mesure]
VAR Previous = CALCULATE([Mesure], <filtre_p√©riode>)
RETURN DIVIDE(Current - Previous, Previous)

// Template YTD
[Mesure] YTD = 
CALCULATE([Mesure], DATESYTD(DimDate[FullDateAlternateKey]))

// Template comparaison N-1
[Mesure] N-1 = 
CALCULATE([Mesure], SAMEPERIODLASTYEAR(DimDate[FullDateAlternateKey]))
```

### Exercices Pratiques

1. Cr√©ez un dashboard avec 4 KPIs : Ventes, Marge, Quantit√©, Clients avec variations YTD
2. Construisez une analyse de saisonnalit√© avec indices mensuels
3. Calculez le CAGR par cat√©gorie de produit sur 3 ans
4. Cr√©ez un graphique waterfall de d√©composition de la croissance
5. Identifiez les top 5 contributeurs √† la croissance mensuelle

### Erreurs Courantes √† √âviter

‚ùå Utiliser DATEDIFF pour calculer l'√¢ge en ann√©es (compte les changements d'ann√©e)  
‚ùå Imbriquer DATESYTD dans SAMEPERIODLASTYEAR (annule DATESYTD)  
‚ùå Oublier de g√©rer les valeurs BLANK dans les calculs de variation  
‚ùå Utiliser TODAY() sans comprendre qu'elle se rafra√Æchit  
‚ùå Comparer YTD sans aligner les p√©riodes (Jan-Mar 2013 vs Jan-Dec 2012)

# 
