# Atelier (SUITE) : DESIGN AGGREGATIONS PAR PARTITION (30 min)

### Concept : StratÃ©gie diffÃ©renciÃ©e

**Principe Ã  expliquer :**

> "Les donnÃ©es anciennes (2022) sont rarement consultÃ©es au dÃ©tail â†’ AgrÃ©gations agressives
> Les donnÃ©es rÃ©centes (2024) sont souvent consultÃ©es â†’ AgrÃ©gations modÃ©rÃ©es"

### StratÃ©gie d'agrÃ©gation

| Partition            | Performance Gain | Raison                          |
| -------------------- | ---------------- | ------------------------------- |
| 2022 (historique)    | 50%              | DonnÃ©es stables, peu de dÃ©tail  |
| 2023 (intermÃ©diaire) | 30%              | Usage modÃ©rÃ©                    |
| 2024 (courante)      | 20%              | Beaucoup de requÃªtes dÃ©taillÃ©es |

---

### DÃ‰MO 1 : Design pour Partition 2022 (50%)

#### Ã‰tape 1 : Lancer

1. Onglet **Aggregations**
2. **Clic droit** sur `Fact Sales (0 conceptions d'agregations)` â†’ **Conception d'Aggregations...**

#### Ã‰tape 2 :

 Choisir Fact Sales 2022

#### Ã‰tape 3 : Review Aggregation Usage â­ **L'Ã‰CRAN CLÃ‰**

**CE QU'ON VOIT :**

```
Cube Objects         | Default | Full | None | Unrestricted
---------------------|---------|------|------|-------------
Dim Date             | 3       | 0    | 0    | 0
  Year               | â—       |      |      |
  Quarter            | â—       |      |      |
  Month              | â—       |      |      |
Dim Product          | 1       | 0    | 0    | 0
  Category           | â—       |      |      |
```

**MODIFICATION IMPORTANTE :**

> "Pour 2022, Year est TOUJOURS utilisÃ© â†’ Mettre en Full"

1. **Cliquer** sur Year Ã— Full
2. Result :

```
Dim Date             | 2       | 1    | 0    | 0
```

3. Next

#### Ã‰tape 4 : Review Object Counts

**CE QU'ON VOIT :**

```
Partition                 | Estimated Rows
--------------------------|---------------
Fact Sales 2022           | ~50,000

Dimension                 | Estimated Members
--------------------------|------------------
Dim Date                  | 365 (annÃ©e 2022)
Dim Product               | 10
```

**EXPLICATION :**

> "SSAS estime ~50,000 lignes pour 2022. Si ce n'est pas correct, cliquez sur Count."

4. Next

#### Ã‰tape 5 : Set Aggregation Options

**CE QU'ON VOIT :**

```
â—‹ L'espace de stockage estimÃ© ... : [  50  ] MB
â— Les gain de performance ...  : [ 50 ] %
â—‹ Je clique sur arrÃªter
â—‹ Ne pas crÃ©er d'aggregations (0%)
```

**DÃ‰MONSTRATION :**

1. SÃ©lectionner **Performance gain reaches : 50%**
   
   #### L'option "50%" signifie :
   
   **"ArrÃªter quand on atteint 50% d'amÃ©lioration des performances"**

**Exemple pratique :**

Sans agrÃ©gations : RequÃªte moyenne = 100 ms

Avec agrÃ©gations optimales (50% de gain) : RequÃªte moyenne = **50 ms**



1. Cliquer **Demarrer**

**Animation :**

```
Designing Aggregations...

Aggregations     : 0 â†’ 5 â†’ 10 â†’ 15 â†’ 18 â†’ 22 âœ“
Estimated Storage: 0 MB â†’ 1.2 MB â†’ 2.8 MB â†’ 4.5 MB
Performance Gain : 0% â†’ 15% â†’ 30% â†’ 42% â†’ 51% âœ“

[=====================>]
```

**DIRE PENDANT QUE Ã‡A TOURNE :**

- "SSAS teste plein de combinaisons"

- "Year est dans TOUTES car on l'a mis en Full"

- "Il s'arrÃªte Ã  51% - mission accomplie"
3. **Noter les rÃ©sultats** :
   
   - Aggregations : ____ (environ 1)
   - Storage : ____ MB (environ 0.150)
   - Gain : ____% (83%)

4. Next â†’ Fin

---

### DÃ‰MO 2 : Design pour Partition 2023 (30%)

1. **Clic droit** sur `Fact Sales 2023` â†’ **Design Aggregations...**
2. **Review Aggregation Usage** :
   - Year â†’ Full (mÃªme stratÃ©gie)
   - Next
3. **Set Aggregation Options** :
   - Performance gain : **30%**
   - Start

**RÃ©sultats attendus :**

- Aggregations : environ 1

- Storage : environ 2.5 MB

- Gain : 31%
4. Next â†’ Finish

---

### DÃ‰MO 3 : Design pour Partition 2024 (20%)

1. **Clic droit** sur `Fact Sales 2024` â†’ **Design Aggregations...**
2. **Review Aggregation Usage** :
   - Year â†’ Full
   - Next
3. **Set Aggregation Options** :
   - Performance gain : **20%**
   - Start

**RÃ©sultats attendus :**

- Aggregations : environ 7

- Storage : environ 1.5 MB

- Gain : 21%
4. Next â†’ Finish

---

### RÃ©sultat Final

**Vue dans l'onglet Aggregations :**

```
Fact Sales 2022  | Aggregation Design 1  | 22 aggs | 4.5 MB | 51%
Fact Sales 2023  | Aggregation Design 2  | 12 aggs | 2.5 MB | 31%
Fact Sales 2024  | Aggregation Design 3  |  7 aggs | 1.5 MB | 21%
```

### Ã‰tape 5 : Deploy et Process

1. **Build â†’ Deploy Solution**
2. Clic droit sur cube â†’ **Process**
3. Process Full â†’ Run â†’ Close

âœ… **AgrÃ©gations optimisÃ©es par partition !**

---

## PARTIE 5 : TESTS DE PERFORMANCE (15 min)

### Test 1 : Query sur annÃ©e historique (2022)

```mdx
SELECT 
    [Measures].[Amount] ON COLUMNS,
    [Dim Date].[Year].[Year].&[2022] ON ROWS
FROM [Demo Aggregations];
```

**Attendu :** RÃ©ponse trÃ¨s rapide (agrÃ©gation Year existe)

### Test 2 : Query dÃ©taillÃ©e sur 2024

```mdx
SELECT 
    [Measures].[Amount] ON COLUMNS,
    NON EMPTY [Dim Date].[Month].[Month].Members ON ROWS
FROM [Demo Aggregations]
WHERE [Dim Date].[Year].[Year].&[2024];
```

**Attendu :** LÃ©gÃ¨rement plus lent (moins d'agrÃ©gations sur 2024)

### Test 3 : Query cross-partition

```mdx
SELECT 
    [Measures].[Amount] ON COLUMNS,
    [Dim Date].[Year].[Year].Members ON ROWS
FROM [Demo Aggregations];
```

**Attendu :** SSAS combine les agrÃ©gations de toutes les partitions

---

## PARTIE 6 : USAGE-BASED OPTIMIZATION (20 min)

### Concept : Optimisation basÃ©e sur l'utilisation rÃ©elle

**ScÃ©nario :**

> "Design Aggregations devine. Usage-Based regarde ce que les VRAIS utilisateurs font."

### Ã‰tape 0 : Activer le Query Log

**Dans SSMS, connectÃ© Ã  SSAS :**

1. Clic droit sur serveur â†’ **Properties** â†’ **General**
2. Cocher **Show Advanced**
3. Trouver **Log\QueryLog\CreateQueryLogTable** â†’ `True`
4. **Log\QueryLog\QueryLogConnectionString** â†’ (laisser vide = mÃªme serveur)
5. **Log\QueryLog\QueryLogSampling** â†’ `10` (Ã©chantillonnage)
6. OK

### Ã‰tape 1 : GÃ©nÃ©rer des requÃªtes utilisateur

**ExÃ©cuter ces requÃªtes 10 fois chacune :**

```mdx
-- RequÃªte frÃ©quente 1 : Par Year et Category sur 2024
SELECT 
    [Measures].[Amount] ON COLUMNS,
    [Dim Date].[Year].[Year].&[2024] ON ROWS
FROM [Demo Aggregations]
WHERE [Dim Product].[Category].[Category].&[Computers];

-- RequÃªte frÃ©quente 2 : Par Quarter sur 2024
SELECT 
    [Measures].[Quantity] ON COLUMNS,
    [Dim Date].[Quarter].[Quarter].Members ON ROWS
FROM [Demo Aggregations]
WHERE [Dim Date].[Year].[Year].&[2024];

-- RequÃªte frÃ©quente 3 : Par Month + Category sur 2023
SELECT 
    [Measures].[Amount] ON COLUMNS,
    [Dim Date].[Month].[Month].Members ON ROWS
FROM [Demo Aggregations]
WHERE ([Dim Date].[Year].[Year].&[2023],
       [Dim Product].[Category].[Category].&[Phones]);
```

### Ã‰tape 2 : VÃ©rifier le log

**Dans SSMS (SQL Server, pas SSAS) :**

```sql
USE master;
SELECT TOP 20 
    MSOLAP_Database,
    MSOLAP_ObjectPath,
    StartTime,
    Duration
FROM OlapQueryLog 
ORDER BY StartTime DESC;
```

**Vous devez voir vos requÃªtes.**

### Ã‰tape 3 : Lancer Usage-Based Optimization pour 2024

1. Onglet **Aggregations**
2. **Clic droit** sur `Fact Sales 2024` â†’ **Usage Based Optimization...**

**Wizard :**

**Ã‰cran 1 : Specify Query Criteria**

- Beginning date : (Aujourd'hui - 1 jour)
- Ending date : Aujourd'hui
- Filter :
  - Partition : Fact Sales 2024
- Next

**Ã‰cran 2 : Review queries**

- Vous voyez vos requÃªtes listÃ©es avec leur frÃ©quence
- **Cocher** les 2-3 requÃªtes sur 2024
- Next

**Ã‰cran 3-5 : MÃªme que Design Aggregations**

- Review Aggregation Usage â†’ Next
- Review Object Counts â†’ Next
- Set Aggregation Options :
  - Performance gain : **30%**
  - Start

**EXPLICATION :**

> "Cette fois, SSAS a crÃ©Ã© des agrÃ©gations spÃ©cifiquement pour Quarter+Computers, Month+Phones, car c'est ce qu'on utilise vraiment sur 2024 !"

**RÃ©sultat :**

- Nouvelles agrÃ©gations : +5 (total ~12)

- Storage : +1 MB (total ~2.5 MB)

- Gain : augmente de 21% â†’ 32%
4. Next â†’ Finish

### Ã‰tape 4 : Deploy et Re-test

1. **Build â†’ Deploy**
2. Process cube
3. Re-exÃ©cuter les requÃªtes frÃ©quentes â†’ Beaucoup plus rapides !

---

## PARTIE 7 : ASSIGN AGGREGATION DESIGN (10 min)

### ScÃ©nario : RÃ©utiliser un design existant

> "J'ai crÃ©Ã© un super design pour 2023. Je veux l'appliquer Ã  2022 aussi."

### MÃ©thode

1. Onglet **Aggregations**
2. **Clic droit** sur `Fact Sales 2022` â†’ **Assign Aggregation Design...**
3. **SÃ©lectionner** : `Aggregation Design 2` (celui de 2023)
4. OK

**RÃ©sultat :**

```
Fact Sales 2022  | Aggregation Design 2  | (partage avec 2023)
Fact Sales 2023  | Aggregation Design 2  |
```

**EXPLICATION :**

> "Les deux partitions partagent maintenant le mÃªme design. TrÃ¨s utile pour des partitions de structure identique."

**âš ï¸ ATTENTION :**

- Les agrÃ©gations sont toujours **calculÃ©es et stockÃ©es sÃ©parÃ©ment** par partition
- Seul le **plan d'agrÃ©gation** est partagÃ©
- Si les donnÃ©es sont diffÃ©rentes (ex: 2022 a 50K lignes, 2023 a 100K), les agrÃ©gations physiques seront diffÃ©rentes

---

## PARTIE 8 : BONNES PRATIQUES (15 min)

### RÃ¨gle 1 : Partitionner par usage ET mode de stockage

| Type de donnÃ©es                  | StratÃ©gie de partition | Mode de stockage   | AgrÃ©gations         | Processing   |
| -------------------------------- | ---------------------- | ------------------ | ------------------- | ------------ |
| **Historiques** (> 2 ans)        | Par annÃ©e              | **MOLAP**          | Agressives (50-70%) | 1x/trimestre |
| **RÃ©centes** (< 1 an)            | Par mois               | **HOLAP**          | ModÃ©rÃ©es (20-30%)   | 1x/semaine   |
| **Courantes** (mois actuel)      | Partition unique       | **ROLAP**          | LÃ©gÃ¨res ou aucune   | Temps rÃ©el   |
| **TrÃ¨s volumineuses** (> 500 GB) | Par annÃ©e + rÃ©gion     | **HOLAP ou ROLAP** | Minimales           | Variable     |

### RÃ¨gle 2 : Choisir le bon mode de stockage

**Arbre de dÃ©cision :**

```
Les donnÃ©es changent-elles frÃ©quemment ?
â”‚
â”œâ”€ NON (historique)
â”‚  â”‚
â”‚  â””â”€ Volume important (> 100 GB) ?
â”‚     â”‚
â”‚     â”œâ”€ OUI â†’ HOLAP (agrÃ©gations performantes, Ã©conomie d'espace)
â”‚     â”‚
â”‚     â””â”€ NON â†’ MOLAP (performance maximale)
â”‚
â””â”€ OUI (temps rÃ©el requis)
   â”‚
   â””â”€ Performance critique ?
      â”‚
      â”œâ”€ OUI â†’ MOLAP + Proactive Caching (cache auto-refresh)
      â”‚
      â””â”€ NON â†’ ROLAP (toujours Ã  jour)
```

### RÃ¨gle 3 : Utiliser Aggregation Usage (par mode)

**Pour chaque attribut :**

| Usage                 | MOLAP        | HOLAP   | ROLAP                   |
| --------------------- | ------------ | ------- | ----------------------- |
| **Toujours utilisÃ©**  | Full         | Full    | N/A (indexed views SQL) |
| **Souvent utilisÃ©**   | Default      | Default | N/A                     |
| **Rarement utilisÃ©**  | None         | None    | N/A                     |
| **Haute cardinalitÃ©** | Unrestricted | None    | N/A                     |

**Note pour ROLAP :**

- Les agrÃ©gations SSAS ne s'appliquent pas

- CrÃ©er des indexed views dans SQL Server pour la performance

- Exemple :
  
  ```sql
  CREATE VIEW AggSales2024_YearWITH SCHEMABINDINGASSELECT     d.Year,    SUM(f.Amount) as TotalAmount,    COUNT_BIG(*) as RowCountFROM dbo.FactSales fINNER JOIN dbo.DimDate d ON f.DateKey = d.DateKeyWHERE d.Year = 2024GROUP BY d.Year;CREATE UNIQUE CLUSTERED INDEX IX_AggSales2024_Year ON AggSales2024_Year(Year);
  ```

### RÃ¨gle 4 : HiÃ©rarchies naturelles prioritaires (selon mode)

**MOLAP :**

- Toutes les hiÃ©rarchies naturelles bÃ©nÃ©ficient des agrÃ©gations
- Year â†’ Quarter â†’ Month â†’ Day (temporelle) âœ…
- Country â†’ Region â†’ City (gÃ©ographique) âœ…

**HOLAP :**

- AgrÃ©gations hauts niveaux (Year, Country) âœ…
- Drill-down vers SQL pour dÃ©tails (Day, City) âš ï¸

**ROLAP :**

- Pas d'agrÃ©gations SSAS
- Indexer les colonnes de hiÃ©rarchies dans SQL Server
- CrÃ©er des indexed views pour combinaisons frÃ©quentes

### RÃ¨gle 5 : Ã‰viter la sur-agrÃ©gation (impact par mode)

**MOLAP - Signe d'alerte :**

- Storage > 30% de la taille des donnÃ©es brutes
- Processing time > 1 heure pour 1 GB de donnÃ©es
- Performance gain stagne (50% â†’ 51% pour +20 agrÃ©gations)

**HOLAP - Signe d'alerte :**

- Aggregation storage > 50% de la taille source
- Drill-down vers dÃ©tail systÃ©matiquement lent

**ROLAP - Signe d'alerte :**

- Queries > 5 secondes systÃ©matiquement
- SQL Server CPU > 80% pendant les requÃªtes
- Solution : passer en HOLAP ou crÃ©er indexed views

### RÃ¨gle 6 : Proactive Caching (hybride MOLAP temps rÃ©el)

**Concept :**

> "Proactive Caching permet d'avoir MOLAP (performance) avec fraÃ®cheur quasi-temps rÃ©el (auto-refresh)"

**Configuration :**

1. **Clic droit** sur partition MOLAP â†’ **Storage Settings...**
2. **Enable proactive caching** âœ…
3. **Settings** :
   - **Silence interval** : 10 seconds (attendre 10s sans changement avant process)
   - **Silence override** : 10 minutes (forcer process aprÃ¨s 10 min max)
   - **Update cache periodically** : 1 hour (refresh pÃ©riodique)

**Cas d'usage :**

```
Partition CurrentMonth (2024-12)
- Mode : MOLAP + Proactive Caching
- FraÃ®cheur : 10s Ã  10 min aprÃ¨s modification SQL
- Performance : Comme MOLAP pur
- IdÃ©al : DonnÃ©es qui changent 10-100 fois/jour (pas milliers)
```

### RÃ¨gle 7 : Timeline de maintenance en production

**Timeline rÃ©aliste avec modes mixtes :**

#### Maintenance mensuelle (dÃ©but de mois)

1. **CrÃ©er nouvelle partition** pour le mois courant
   
   ```
   Janvier 2025 (nouveau)
   - Mode : ROLAP (ou MOLAP + Proactive Caching)
   - AgrÃ©gations : Aucune (temps rÃ©el)
   ```

2. **Convertir le mois prÃ©cÃ©dent** (DÃ©cembre 2024)
   
   ```
   ROLAP â†’ HOLAP
   - Ajouter agrÃ©gations (20%)
   - Process Full
   - DonnÃ©es stabilisÃ©es
   ```

3. **Optimiser les mois -2 Ã  -12** (si nÃ©cessaire)
   
   ```
   HOLAP reste HOLAP
   - Usage-Based Optimization (si query logs disponibles)
   ```

#### Maintenance trimestrielle

1. **Convertir Q-1 en MOLAP**
   
   ```
   Exemple : Fin Mars 2025
   - Q4 2024 (Oct-Nov-Dec) : HOLAP â†’ MOLAP
   - AgrÃ©gations agressives (40-50%)
   - Compression maximale
   ```

2. **RÃ©-analyser les agrÃ©gations**
   
   - Query logs sur 3 mois
   - Usage-Based Optimization

#### Maintenance annuelle

1. **Consolider les annÃ©es N-2+**
   
   ```
   Exemple : 2023 et avant
   - Merger les partitions mensuelles en annuelle (optionnel)
   - Mode : MOLAP
   - AgrÃ©gations : 60-70%
   - Processing : 1x/an
   ```

2. **Archivage** (optionnel)
   
   ```
   AnnÃ©es > N-5
   - Exporter vers fichiers
   - Ou cubes sÃ©parÃ©s (archives)
   ```

### RÃ¨gle 8 : Monitoring des modes de stockage

**RequÃªtes DMV pour surveiller :**

```sql
-- Voir les partitions et leurs modes
SELECT 
    CUBE_NAME,
    MEASUREGROUP_NAME,
    PARTITION_NAME,
    TYPE as StorageMode,
    ROWS,
    AGGREGATION_DESIGN_ID,
    DATA_SIZE_BYTES / 1024 / 1024 as SizeMB
FROM $SYSTEM.DISCOVER_PARTITIONS
WHERE CUBE_NAME = 'Demo Aggregations'
ORDER BY PARTITION_NAME;

-- StorageMode values:
-- 1 = MOLAP
-- 2 = ROLAP  
-- 3 = HOLAP
```

**Alertes Ã  configurer :**

| MÃ©trique                 | Seuil        | Action                                 |
| ------------------------ | ------------ | -------------------------------------- |
| MOLAP partition data age | > 24h        | VÃ©rifier processing schedule           |
| ROLAP query duration avg | > 2s         | CrÃ©er indexed views SQL                |
| HOLAP drill-down avg     | > 5s         | ConsidÃ©rer conversion MOLAP            |
| Storage growth           | > 50 GB/mois | Revoir stratÃ©gie compression/archivage |

---

## ARCHITECTURE FINALE RECOMMANDÃ‰E

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cube Sales Production (5 ans de donnÃ©es, 500 GB source)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ğŸ“¦ AnnÃ©es 2020-2022 (Historique lointain)                        â”‚
â”‚     - Mode : MOLAP                                                 â”‚
â”‚     - Partitionnement : Par annÃ©e (3 partitions)                  â”‚
â”‚     - AgrÃ©gations : 60-70% (trÃ¨s agressives)                      â”‚
â”‚     - Storage SSAS : 15 GB (compression 10:1)                     â”‚
â”‚     - Processing : 1x/trimestre                                    â”‚
â”‚     - Usage : Rapports annuels, analyses de tendances             â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“¦ AnnÃ©e 2023 (Historique rÃ©cent)                                â”‚
â”‚     - Mode : MOLAP                                                 â”‚
â”‚     - Partitionnement : Par mois (12 partitions)                  â”‚
â”‚     - AgrÃ©gations : 40-50%                                        â”‚
â”‚     - Storage SSAS : 12 GB                                        â”‚
â”‚     - Processing : 1x/mois                                         â”‚
â”‚     - Usage : Rapports mensuels, comparaisons YoY                 â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“¦ AnnÃ©e 2024 Jan-Oct (DonnÃ©es stabilisÃ©es)                      â”‚
â”‚     - Mode : HOLAP                                                 â”‚
â”‚     - Partitionnement : Par mois (10 partitions)                  â”‚
â”‚     - AgrÃ©gations : 20-30% (agrÃ©gations seulement)               â”‚
â”‚     - Storage SSAS : 3 GB (agrÃ©gations)                           â”‚
â”‚     - Storage SQL : 80 GB (donnÃ©es dÃ©taillÃ©es)                    â”‚
â”‚     - Processing : 1x/semaine                                      â”‚
â”‚     - Usage : Dashboards, analyses opÃ©rationnelles                â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“¦ Novembre 2024 (Mois prÃ©cÃ©dent)                                â”‚
â”‚     - Mode : HOLAP avec agrÃ©gations optimisÃ©es                    â”‚
â”‚     - Partitionnement : 1 partition                               â”‚
â”‚     - AgrÃ©gations : 20% (Usage-Based)                             â”‚
â”‚     - Storage SSAS : 400 MB                                        â”‚
â”‚     - Processing : 1x/jour                                         â”‚
â”‚     - Usage : Analyses rÃ©centes, corrections de donnÃ©es           â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“¦ DÃ©cembre 2024 (Mois courant)                                  â”‚
â”‚     - Mode : MOLAP + Proactive Caching                            â”‚
â”‚     - Partitionnement : 1 partition                               â”‚
â”‚     - AgrÃ©gations : 15% (lÃ©gÃ¨res)                                 â”‚
â”‚     - Storage SSAS : 500 MB                                        â”‚
â”‚     - Refresh : Auto (10s-10min aprÃ¨s changement SQL)             â”‚
â”‚     - Usage : Dashboards temps rÃ©el, monitoring quotidien         â”‚
â”‚                                                                     â”‚
â”‚  ğŸ“Š TOTAUX                                                         â”‚
â”‚     - Partitions : 27 (3 + 12 + 10 + 1 + 1)                       â”‚
â”‚     - Storage SSAS : ~31 GB                                        â”‚
â”‚     - Storage SQL : ~400 GB (source complÃ¨te)                     â”‚
â”‚     - Compression ratio : 12:1                                     â”‚
â”‚     - FraÃ®cheur : 10s Ã  10min (mois courant)                      â”‚
â”‚     - Performance : < 50ms (95% des requÃªtes)                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Avantages de cette architecture :**

1. âœ… **Performance optimale** : 95% requÃªtes < 50ms
2. âœ… **Espace maÃ®trisÃ©** : Compression 12:1 global
3. âœ… **FraÃ®cheur** : Mois courant quasi temps-rÃ©el
4. âœ… **Maintenance simplifiÃ©e** : Processing diffÃ©renciÃ©
5. âœ… **Ã‰volutivitÃ©** : Ajout facile de nouvelles partitions
6. âœ… **CoÃ»t optimisÃ©** : HOLAP Ã©conomise 80% espace sur rÃ©cent

---

## TABLEAU RÃ‰CAPITULATIF : 3 MÃ‰THODES D'AGRÃ‰GATION Ã— 3 MODES DE STOCKAGE

### A. MÃ©thodes d'agrÃ©gation (identique tous modes sauf ROLAP)

| MÃ©thode                       | Quand l'utiliser                                                                                 | Avantages                                                                            | InconvÃ©nients                                                                                   |
| ----------------------------- | ------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------- |
| **Design Aggregations**       | - Nouveau cube<br>- Pas d'historique d'usage<br>- Mise en place initiale                         | - Rapide<br>- Automatique<br>- Couvre les cas gÃ©nÃ©raux                               | - GÃ©nÃ©rique<br>- Pas optimisÃ© pour usage rÃ©el<br>- Peut crÃ©er des agrÃ©gations inutiles          |
| **Usage-Based Optimization**  | - AprÃ¨s 1-2 semaines en prod<br>- Quand on a des query logs<br>- Pour affiner un design existant | - CiblÃ© sur usage rÃ©el<br>- Performance maximale<br>- Ã‰vite les agrÃ©gations inutiles | - Besoin de query log<br>- Peut biaiser vers utilisateurs actuels<br>- Ã€ refaire pÃ©riodiquement |
| **Assign Aggregation Design** | - Multiples partitions similaires<br>- Structure identique<br>- Maintenance simplifiÃ©e           | - RÃ©utilisation<br>- Consistance<br>- Maintenance facile                             | - Design doit exister<br>- Pas optimal si donnÃ©es diffÃ©rentes<br>- Moins flexible               |

### B. Modes de stockage (impact agrÃ©gations)

| Mode                  | AgrÃ©gations SSAS                                   | Performance                                                  | FraÃ®cheur                               | Espace SSAS                | Cas d'usage idÃ©al                                        |
| --------------------- | -------------------------------------------------- | ------------------------------------------------------------ | --------------------------------------- | -------------------------- | -------------------------------------------------------- |
| **MOLAP**             | âœ… Pleinement supportÃ©es<br>StockÃ©es avec donnÃ©es   | â­â­â­â­â­<br>5-20 ms                                             | âš ï¸ Processing requis<br>DonnÃ©es figÃ©es  | âš ï¸ Ã‰levÃ©<br>DonnÃ©es + aggs | Historique, rapports BI, performance critique            |
| **HOLAP**             | âœ… Pleinement supportÃ©es<br>StockÃ©es seules         | â­â­â­â­ Aggs<br>â­â­ DÃ©tail<br>10-30 ms aggs<br>100-200 ms dÃ©tail | âš ï¸ Aggs figÃ©es<br>âœ… DÃ©tail temps rÃ©el   | âœ… Faible<br>Aggs seulement | Volumes moyens, rapports agrÃ©gÃ©s, drill-down occasionnel |
| **ROLAP**             | âŒ Non supportÃ©es<br>(SQL indexed views Ã  la place) | â­â­<br>50-500 ms                                              | âœ… Temps rÃ©el                            | âœ… Minimal<br>MÃ©tadonnÃ©es   | Temps rÃ©el requis, gros volumes, espace limitÃ©           |
| **MOLAP + Proactive** | âœ… SupportÃ©es<br>Auto-refresh                       | â­â­â­â­â­<br>5-20 ms                                             | âœ… Quasi temps rÃ©el<br>10s-10min latence | âš ï¸ Ã‰levÃ©<br>Comme MOLAP    | Compromis performance/fraÃ®cheur, mois courant            |

### C. Matrice dÃ©cisionnelle : Mode Ã— Type de donnÃ©es

|                          | Historique (>2 ans) | RÃ©cent (<1 an)    | Courant (mois actuel)    | TrÃ¨s volumineux (>500 GB) |
| ------------------------ | ------------------- | ----------------- | ------------------------ | ------------------------- |
| **Performance critique** | MOLAP 50-70% aggs   | MOLAP 30-40% aggs | MOLAP + Proactive 10-20% | HOLAP 20-30% aggs         |
| **Ã‰quilibrÃ©**            | MOLAP 40-50%        | HOLAP 20-30%      | MOLAP + Proactive 10%    | HOLAP 15-20%              |
| **Espace limitÃ©**        | HOLAP 30-40%        | HOLAP 15-25%      | ROLAP + indexed views    | ROLAP + indexed views     |
| **Temps rÃ©el requis**    | N/A (ne change pas) | MOLAP + Proactive | ROLAP                    | ROLAP                     |

### D. Combinaisons recommandÃ©es (Production)

| Partition type           | Mode                          | AgrÃ©gations                   | Processing         | Exemple concret |
| ------------------------ | ----------------------------- | ----------------------------- | ------------------ | --------------- |
| **AnnÃ©es N-3+**          | MOLAP                         | 60-70% (Design)               | 1x/trimestre       | 2020, 2021      |
| **AnnÃ©e N-2**            | MOLAP                         | 40-50% (Design + Usage-Based) | 1x/mois            | 2022            |
| **AnnÃ©e N-1**            | MOLAP ou HOLAP                | 30-40% (Usage-Based)          | 1x/semaine         | 2023            |
| **AnnÃ©e courante Q1-Q3** | HOLAP                         | 20-30% (Usage-Based)          | 1x/semaine         | 2024 Jan-Sep    |
| **Mois N-1**             | HOLAP ou MOLAP                | 15-20% (Usage-Based)          | 1x/jour            | 2024 Nov        |
| **Mois courant**         | MOLAP + Proactive<br>ou ROLAP | 10-15% ou aucune              | Auto ou temps rÃ©el | 2024 Dec        |

### E. Aide au choix rapide

**Question 1 : Les donnÃ©es changent-elles aprÃ¨s insertion ?**

- Non â†’ MOLAP (historique)
- Oui, rarement â†’ MOLAP + Proactive Caching
- Oui, souvent â†’ ROLAP

**Question 2 : Quel est le volume de cette partition ?**

- < 10 GB â†’ MOLAP (rapide Ã  processer)
- 10-100 GB â†’ HOLAP (bon compromis)
- > 100 GB â†’ HOLAP ou ROLAP

**Question 3 : Quel est le pattern d'usage principal ?**

- Rapports agrÃ©gÃ©s (dashboards) â†’ MOLAP ou HOLAP
- Drill-down frÃ©quent â†’ MOLAP
- Queries ad-hoc variÃ©es â†’ MOLAP avec bonnes agrÃ©gations
- Temps rÃ©el critique â†’ ROLAP

**Question 4 : Quelle est la contrainte prioritaire ?**

- Performance max â†’ MOLAP
- Espace disque â†’ HOLAP puis ROLAP
- FraÃ®cheur â†’ ROLAP ou MOLAP + Proactive
- CoÃ»t de processing â†’ HOLAP ou ROLAP

---

## RÃ‰SUMÃ‰ DE L'ATELIER

### Ce qu'on a appris

1. âœ… **Partitions = clÃ© de performance**
   
   - Une partition = un sous-ensemble de donnÃ©es
   - AgrÃ©gations dÃ©finies PAR partition
   - Processing incrÃ©mental possible
   - **Mode de stockage PAR partition**

2. âœ… **4 modes de stockage**
   
   - **MOLAP** : Performance max, espace Ã©levÃ©, processing requis
   - **ROLAP** : Temps rÃ©el, lent, pas d'espace SSAS
   - **HOLAP** : Compromis, aggs rapides, dÃ©tail SQL
   - **Proactive Caching** : MOLAP avec auto-refresh

3. âœ… **3 stratÃ©gies d'agrÃ©gation**
   
   - Design : rapide, gÃ©nÃ©rique
   - Usage-Based : optimal, basÃ© sur usage rÃ©el
   - Assign : rÃ©utilisation, maintenance

4. âœ… **Optimisation diffÃ©renciÃ©e**
   
   - Historique : MOLAP + agrÃ©gations agressives (50-70%)
   - IntermÃ©diaire : HOLAP + agrÃ©gations modÃ©rÃ©es (20-30%)
   - Courante : ROLAP ou MOLAP+Proactive (0-15%)

5. âœ… **Bonnes pratiques**
   
   - Partitionner par usage temporel ET mode de stockage
   - Utiliser Aggregation Usage intelligemment (sauf ROLAP)
   - Favoriser les hiÃ©rarchies naturelles
   - Ã‰viter la sur-agrÃ©gation
   - RÃ©-optimiser avec Usage-Based pÃ©riodiquement
   - Monitorer les tailles et performances

### Architecture finale (version mixte)

```
DemoAggregations Cube
â”‚
â”œâ”€â”€ Fact Sales 2022 [MOLAP]
â”‚   â”œâ”€â”€ Aggregation Design 1 (50% gain, 22 aggs)
â”‚   â”œâ”€â”€ Storage: 2.5 MB (donnÃ©es + aggs compressÃ©es)
â”‚   â”œâ”€â”€ Processing: 1x/trimestre
â”‚   â””â”€â”€ Data: ~50,000 rows
â”‚
â”œâ”€â”€ Fact Sales 2023 [HOLAP]
â”‚   â”œâ”€â”€ Aggregation Design 2 (30% gain, 12 aggs)
â”‚   â”œâ”€â”€ Storage SSAS: 0.8 MB (aggs seulement)
â”‚   â”œâ”€â”€ Storage SQL: 5 MB (donnÃ©es source)
â”‚   â”œâ”€â”€ Processing: 1x/mois
â”‚   â””â”€â”€ Data: ~50,000 rows (in SQL)
â”‚
â””â”€â”€ Fact Sales 2024 [ROLAP]
    â”œâ”€â”€ No aggregations (or SQL indexed views)
    â”œâ”€â”€ Storage SSAS: 0 KB (mÃ©tadonnÃ©es)
    â”œâ”€â”€ Storage SQL: 5 MB (donnÃ©es source)
    â”œâ”€â”€ Refresh: Temps rÃ©el
    â””â”€â”€ Data: ~50,000 rows (in SQL)

Total SSAS: 3.3 MB (vs 15 MB en full MOLAP = Ã©conomie 78%)
Total SQL: 10 MB (source)
Performance: MOLAP=10ms, HOLAP=20ms agg/120ms dÃ©tail, ROLAP=80ms
```

### Prochaines Ã©tapes en production

1. **Maintenance mensuelle** :
   
   - CrÃ©er nouvelle partition pour le mois courant
   - Copier le design du mois prÃ©cÃ©dent (Assign)
   - Process incrÃ©mental

2. **Optimisation trimestrielle** :
   
   - Analyser les query logs
   - Usage-Based Optimization sur partitions actives
   - RÃ©Ã©valuer la stratÃ©gie d'agrÃ©gation

3. **Nettoyage annuel** :
   
   - Merger les anciennes partitions
   - AgrÃ©gations trÃ¨s agressives sur historique
   - Archivage si nÃ©cessaire

---

## EXERCICES PRATIQUES

### Exercice 1 : CrÃ©er des partitions mensuelles pour 2024 avec modes mixtes

**Objectif :** CrÃ©er 12 partitions (Jan-2024 Ã  Dec-2024) avec stratÃ©gie mixte

**Configuration recommandÃ©e :**

- Jan-Sep 2024 : HOLAP (stabilisÃ©)
- Oct-Nov 2024 : HOLAP ou MOLAP
- Dec 2024 : MOLAP + Proactive Caching (courant)

**Indice :** Utiliser des requÃªtes WHERE comme :

```sql
WHERE DateKey >= 20240101 AND DateKey < 20240201  -- Jan
WHERE DateKey >= 20240201 AND DateKey < 20240301  -- Feb
...
```

**Questions :**

1. Quelle est la diffÃ©rence de taille totale entre full MOLAP vs mixte ?
2. Quel est le temps de processing pour chaque mode ?
3. Quelle est la diffÃ©rence de performance sur agrÃ©gations vs drill-down ?

---

### Exercice 2 : Tester Proactive Caching

**Objectif :** Configurer une partition MOLAP avec auto-refresh

**Ã‰tapes :**

1. CrÃ©er partition Dec-2024 en MOLAP

2. Activer Proactive Caching :
   
   - Silence interval : 10s
   - Silence override : 5 min

3. InsÃ©rer des donnÃ©es dans SQL Server :
   
   ```sql
   INSERT INTO FactSales VALUES (20241215, 1, 5, 1500.00);
   ```

4. Attendre 10-15 secondes

5. RequÃªter le cube â†’ DonnÃ©es apparaissent automatiquement

**Questions :**

1. Combien de temps avant que les donnÃ©es apparaissent ?
2. Que se passe-t-il si on insÃ¨re 100 lignes/seconde ?
3. Quelle est la diffÃ©rence de performance vs ROLAP pur ?

---

### Exercice 3 : Optimiser ROLAP avec Indexed Views

**Objectif :** CrÃ©er des indexed views SQL pour amÃ©liorer performance ROLAP

**SQL Ã  exÃ©cuter :**

```sql
-- Vue agrÃ©gÃ©e Year + Category
CREATE VIEW AggSales_Year_Category
WITH SCHEMABINDING
AS
SELECT 
    d.Year,
    p.Category,
    SUM(f.Amount) as TotalAmount,
    SUM(f.Quantity) as TotalQuantity,
    COUNT_BIG(*) as RowCount
FROM dbo.FactSales f
INNER JOIN dbo.DimDate d ON f.DateKey = d.DateKey
INNER JOIN dbo.DimProduct p ON f.ProductKey = p.ProductKey
WHERE d.Year = 2024
GROUP BY d.Year, p.Category;
GO

-- Index clustered
CREATE UNIQUE CLUSTERED INDEX IX_AggSales_Year_Category 
ON AggSales_Year_Category(Year, Category);
GO
```

**Test :**

```mdx
SELECT 
    [Measures].[Amount] ON COLUMNS,
    [Dim Product].[Category].[Category].Members ON ROWS
FROM [Demo Aggregations]
WHERE [Dim Date].[Year].[Year].&[2024];
```

**Questions :**

1. Temps avant indexed view ? AprÃ¨s ?
2. Impact sur CPU SQL Server ?
3. Combien d'indexed views crÃ©er (Ã©quilibre maintenance/performance) ?

---

### Exercice 4 : Simuler une annÃ©e complÃ¨te avec stratÃ©gie production

**Objectif :** ImplÃ©menter l'architecture recommandÃ©e

**Configuration :**

1. **Q1 2024 (Jan-Mar)** : HOLAP, aggs 30%, process 1x/mois
2. **Q2 2024 (Apr-Jun)** : HOLAP, aggs 25%, process 1x/mois
3. **Q3 2024 (Jul-Sep)** : HOLAP, aggs 20%, process 1x/semaine
4. **Oct-Nov 2024** : MOLAP, aggs 15%, process 1x/semaine
5. **Dec 2024** : MOLAP + Proactive Caching, aggs 10%

**Mesurer :**

- Storage total SSAS
- Storage total SQL
- Temps de processing moyen
- Performance moyenne queries (agrÃ©gÃ©es vs dÃ©tail)

**Comparer avec :**

- Full MOLAP (toutes partitions)
- Full ROLAP (toutes partitions)

---

### Exercice 5 : Analyse de Query Performance par mode

**Objectif :** Comprendre l'impact du mode sur diffÃ©rents types de requÃªtes

**RequÃªtes Ã  tester sur chaque partition (2022 MOLAP, 2023 HOLAP, 2024 ROLAP) :**

**Q1 - AgrÃ©gation simple :**

```mdx
SELECT [Measures].[Amount] ON 0
FROM [Demo Aggregations]
WHERE [Dim Date].[Year].[Year].&[YEAR];
```

**Q2 - AgrÃ©gation + 1 dimension :**

```mdx
SELECT 
    [Measures].[Amount] ON 0,
    [Dim Product].[Category].[Category].Members ON 1
FROM [Demo Aggregations]
WHERE [Dim Date].[Year].[Year].&[YEAR];
```

**Q3 - Drill-down complet :**

```mdx
SELECT 
    {[Measures].[Amount], [Measures].[Quantity]} ON 0,
    NON EMPTY [Dim Product].[Product Name].[Product Name].Members ON 1
FROM [Demo Aggregations]
WHERE ([Dim Date].[Year].[Year].&[YEAR], 
       [Dim Date].[Month].[Month].&[1]);
```

**CrÃ©er un tableau de rÃ©sultats :**

| Query | MOLAP (2022) | HOLAP (2023) | ROLAP (2024) | Notes |
| ----- | ------------ | ------------ | ------------ | ----- |
| Q1    | ___ ms       | ___ ms       | ___ ms       |       |
| Q2    | ___ ms       | ___ ms       | ___ ms       |       |
| Q3    | ___ ms       | ___ ms       | ___ ms       |       |

**Analyser :**

1. Sur quelle query la diffÃ©rence est maximale ?
2. HOLAP est-il vraiment un bon compromis ?
3. Dans quels cas ROLAP est acceptable ?

---

## FIN DE L'ATELIER

ğŸ¯ **Objectifs atteints :**

- âœ… Partitions crÃ©Ã©es et configurÃ©es
- âœ… **4 modes de stockage maÃ®trisÃ©s (MOLAP, ROLAP, HOLAP, Proactive Caching)**
- âœ… AgrÃ©gations optimisÃ©es par partition ET par mode
- âœ… 3 mÃ©thodes d'agrÃ©gation maÃ®trisÃ©es
- âœ… Bonnes pratiques appliquÃ©es avec stratÃ©gie mixte
- âœ… Architecture production rÃ©aliste

ğŸ“š **Pour aller plus loin :**

- Partitions distantes (remote partitions)
- Proactive caching avancÃ© (notifications SQL)
- AgrÃ©gations rigides (rigid aggregations)
- MOLAP optimization avancÃ©
- **Migration vers SSAS Tabular (In-Memory xVelocity)**
- DirectQuery mode (Ã©quivalent ROLAP Tabular)

---

## ANNEXE A : MOLAP vs In-Memory (Tabular)

### Clarification importante

**Question frÃ©quente :** "Quelle est la diffÃ©rence entre MOLAP et In-Memory ?"

**RÃ©ponse :**

| Aspect               | SSAS Multidimensional MOLAP    | SSAS Tabular In-Memory                                     |
| -------------------- | ------------------------------ | ---------------------------------------------------------- |
| **Moteur**           | Multidimensional (MDX)         | Tabular/Columnar (DAX)                                     |
| **Stockage mÃ©moire** | Cache en RAM + fichiers disque | **Tout en RAM** (xVelocity)                                |
| **Compression**      | 5:1 Ã  10:1                     | 10:1 Ã  100:1 (columnstore)                                 |
| **RequÃªtes**         | MDX                            | DAX (SQL-like)                                             |
| **AgrÃ©gations**      | Pre-calculÃ©es et stockÃ©es      | **CalculÃ©es Ã  la volÃ©e** (trÃ¨s rapide grÃ¢ce Ã  columnstore) |
| **Limites mÃ©moire**  | Cache configurable             | LimitÃ© par RAM serveur                                     |
| **Performance**      | Excellente avec aggs           | Excellente native                                          |
| **ComplexitÃ©**       | Ã‰levÃ©e (dimensions, cubes)     | Plus simple (modÃ¨le relationnel)                           |

**En rÃ©sumÃ© :**

- **MOLAP (Multidimensional)** = DonnÃ©es compressÃ©es sur disque + cache RAM + agrÃ©gations prÃ©-calculÃ©es
- **In-Memory (Tabular)** = Tout en RAM, columnstore ultra-compressÃ©, agrÃ©gations dynamiques

**Cet atelier couvre SSAS Multidimensional.** Pour In-Memory Tabular, c'est un produit diffÃ©rent avec des concepts distincts.

---

## ANNEXE B : COMMANDES XMLA AVANCÃ‰ES

### VÃ©rifier les agrÃ©gations d'une partition

```xmla
<Discover xmlns="urn:schemas-microsoft-com:xml-analysis">
  <RequestType>DISCOVER_PARTITION_STAT</RequestType>
  <Restrictions>
    <RestrictionList>
      <DATABASE_NAME>DemoAggregations</DATABASE_NAME>
      <CUBE_NAME>Demo Aggregations</CUBE_NAME>
    </RestrictionList>
  </Restrictions>
</Discover>
```

### Changer le mode de stockage d'une partition (XMLA)

```xmla
<Alter xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <Object>
    <DatabaseID>DemoAggregations</DatabaseID>
    <CubeID>Demo Aggregations</CubeID>
    <MeasureGroupID>Fact Sales</MeasureGroupID>
    <PartitionID>Fact Sales 2024</PartitionID>
  </Object>
  <ObjectDefinition>
    <Partition>
      <StorageMode>Holap</StorageMode> <!-- Molap, Rolap, Holap -->
    </Partition>
  </ObjectDefinition>
</Alter>
```

### Retraiter une seule partition

```xmla
<Batch xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <Process>
    <Object>
      <DatabaseID>DemoAggregations</DatabaseID>
      <CubeID>Demo Aggregations</CubeID>
      <MeasureGroupID>Fact Sales</MeasureGroupID>
      <PartitionID>Fact Sales 2024</PartitionID>
    </Object>
    <Type>ProcessFull</Type>
  </Process>
</Batch>
```

### Activer Proactive Caching (XMLA)

```xmla
<Alter xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <Object>
    <DatabaseID>DemoAggregations</DatabaseID>
    <CubeID>Demo Aggregations</CubeID>
    <MeasureGroupID>Fact Sales</MeasureGroupID>
    <PartitionID>Fact Sales 2024</PartitionID>
  </Object>
  <ObjectDefinition>
    <Partition>
      <StorageMode>Molap</StorageMode>
      <ProactiveCaching>
        <Enabled>true</Enabled>
        <SilenceInterval>PT10S</SilenceInterval>
        <SilenceOverrideInterval>PT10M</SilenceOverrideInterval>
        <Source xsi:type="ProactiveCachingInheritedBinding" />
      </ProactiveCaching>
    </Partition>
  </ObjectDefinition>
</Alter>
```

### Voir les agrÃ©gations utilisÃ©es par une requÃªte (Profiler)

**Activer SQL Server Profiler :**

1. Profiler â†’ New Trace â†’ SSAS

2. Events Ã  capturer :
   
   - **Query Begin** : DÃ©but requÃªte
   - **Query End** : Fin requÃªte
   - **Query Subcube** : Sous-cubes interrogÃ©s
   - **Get Data From Aggregation** : **AgrÃ©gation utilisÃ©e** â­
   - **Get Data From Cache** : DonnÃ©es en cache
   - **Execute SQL** : RequÃªte SQL (si ROLAP/HOLAP)

3. ExÃ©cuter requÃªte MDX

4. Analyser la trace :
   
   ```
   Query Begin        : SELECT [Amount]...Query Subcube      : [2022].[All]Get Data From Agg  : Aggregation15 (Year+Category)  â† AgrÃ©gation utilisÃ©eGet Data From Cache: Hit (0 ms)Query End          : Duration 8ms
   ```

**InterprÃ©tation :**

- **Get Data From Aggregation** = AgrÃ©gation SSAS utilisÃ©e (MOLAP/HOLAP)
- **Execute SQL** = RequÃªte vers SQL Server (ROLAP/HOLAP dÃ©tail)
- **Get Data From Cache** = DonnÃ©es dÃ©jÃ  en mÃ©moire

---

## ANNEXE C : SCRIPTS UTILES

### Script PowerShell : CrÃ©er partitions mensuelles automatiquement

```powershell
# Connexion SSAS
$serverName = "localhost"
$databaseName = "DemoAggregations"
$cubeName = "Demo Aggregations"
$measureGroupName = "Fact Sales"

# Charger AMO
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.AnalysisServices") | Out-Null

# Connexion
$server = New-Object Microsoft.AnalysisServices.Server
$server.Connect($serverName)
$db = $server.Databases[$databaseName]
$cube = $db.Cubes[$cubeName]
$mg = $cube.MeasureGroups[$measureGroupName]

# CrÃ©er partitions pour 2024 (12 mois)
for ($month = 1; $month -le 12; $month++) {
    $startDate = Get-Date -Year 2024 -Month $month -Day 1
    $endDate = $startDate.AddMonths(1)

    $partitionName = "Fact Sales 2024-" + $startDate.ToString("MM")
    $query = "SELECT * FROM FactSales WHERE DateKey >= " + 
             $startDate.ToString("yyyyMMdd") + " AND DateKey < " + 
             $endDate.ToString("yyyyMMdd")

    # CrÃ©er partition
    $partition = $mg.Partitions.Add($partitionName)
    $partition.Source = New-Object Microsoft.AnalysisServices.QueryBinding `
        -ArgumentList $db.DataSources[0].ID, $query

    # Mode de stockage (HOLAP pour mois passÃ©s, MOLAP pour courant)
    if ($month -eq 12) {
        $partition.StorageMode = [Microsoft.AnalysisServices.StorageMode]::Molap
        # Activer Proactive Caching
        $partition.ProactiveCaching.Enabled = $true
        $partition.ProactiveCaching.SilenceInterval = 10000 # 10s
    } else {
        $partition.StorageMode = [Microsoft.AnalysisServices.StorageMode]::Holap
    }

    Write-Host "Partition crÃ©Ã©e: $partitionName ($($partition.StorageMode))"
}

# Sauvegarder
$mg.Update([Microsoft.AnalysisServices.UpdateOptions]::ExpandFull)
$server.Disconnect()

Write-Host "12 partitions mensuelles crÃ©Ã©es avec succÃ¨s!"
```

### Script T-SQL : CrÃ©er indexed views pour ROLAP

```sql
-- Vue agrÃ©gÃ©e pour Year
CREATE VIEW dbo.AggSales_Year
WITH SCHEMABINDING
AS
SELECT 
    d.Year,
    SUM(f.Amount) as TotalAmount,
    SUM(f.Quantity) as TotalQuantity,
    COUNT_BIG(*) as RowCount
FROM dbo.FactSales f
INNER JOIN dbo.DimDate d ON f.DateKey = d.DateKey
GROUP BY d.Year;
GO

CREATE UNIQUE CLUSTERED INDEX IX_AggSales_Year ON dbo.AggSales_Year(Year);
GO

-- Vue agrÃ©gÃ©e pour Year + Quarter
CREATE VIEW dbo.AggSales_Year_Quarter
WITH SCHEMABINDING
AS
SELECT 
    d.Year,
    d.Quarter,
    SUM(f.Amount) as TotalAmount,
    SUM(f.Quantity) as TotalQuantity,
    COUNT_BIG(*) as RowCount
FROM dbo.FactSales f
INNER JOIN dbo.DimDate d ON f.DateKey = d.DateKey
GROUP BY d.Year, d.Quarter;
GO

CREATE UNIQUE CLUSTERED INDEX IX_AggSales_Year_Quarter 
ON dbo.AggSales_Year_Quarter(Year, Quarter);
GO

-- Vue agrÃ©gÃ©e pour Year + Category
CREATE VIEW dbo.AggSales_Year_Category
WITH SCHEMABINDING
AS
SELECT 
    d.Year,
    p.Category,
    SUM(f.Amount) as TotalAmount,
    SUM(f.Quantity) as TotalQuantity,
    COUNT_BIG(*) as RowCount
FROM dbo.FactSales f
INNER JOIN dbo.DimDate d ON f.DateKey = d.DateKey
INNER JOIN dbo.DimProduct p ON f.ProductKey = p.ProductKey
GROUP BY d.Year, p.Category;
GO

CREATE UNIQUE CLUSTERED INDEX IX_AggSales_Year_Category 
ON dbo.AggSales_Year_Category(Year, Category);
GO

-- Statistiques (pour que l'optimiseur SQL les utilise)
UPDATE STATISTICS dbo.AggSales_Year;
UPDATE STATISTICS dbo.AggSales_Year_Quarter;
UPDATE STATISTICS dbo.AggSales_Year_Category;
```
