# üìä TechMart Electronics - Data Warehouse Complet V2.0

## üéØ Vue d'ensemble

Ce Data Warehouse contient **3 ann√©es compl√®tes de donn√©es transactionnelles** (2022-2024) pour une cha√Æne fictive de magasins d'√©lectronique **TechMart** op√©rant en Europe et Afrique du Nord.

### Architecture

- **8 Dimensions** : Date, Time, Customer, Product, Store, SalesPerson, Promotion, Campaign
- **1 Table de faits** : FactProductSales avec 7 mesures + 3 colonnes calcul√©es
- **~65,000 transactions** r√©parties sur 3 ann√©es
- **Patterns r√©alistes** : Black Friday, promotions, campagnes marketing, saisonnalit√©

---

## üÜï Nouveaut√©s Version 2.0

### ‚ú® Nouvelles dimensions

- **DimPromotion** : 20 promotions (Black Friday, Summer Sale, etc.)
- **DimCampaign** : 12 campagnes marketing annuelles

### ‚ú® Nouvelles mesures dans FactProductSales

| Mesure              | Description                           | Valeurs typiques       |
| ------------------- | ------------------------------------- | ---------------------- |
| **Quantity**        | Quantit√© diversifi√©e par type produit | 1-5 (selon cat√©gorie)  |
| **UnitPrice**       | Prix unitaire du produit              | 49‚Ç¨ - 3199‚Ç¨            |
| **DiscountAmount**  | Remise commerciale                    | 0-30% selon promotions |
| **TaxAmount**       | TVA (20%)                             | 20% du net             |
| **PromotionAmount** | Co√ªt des promotions                   | 60% des remises        |
| **CampaignCost**    | Co√ªt marketing par transaction        | Budget/transactions    |
| **DefectQuantity**  | Produits d√©fectueux                   | 0-2% al√©atoire         |

### ‚ú® Colonnes calcul√©es

- **SubTotal** = Quantity √ó UnitPrice
- **TotalAmount** = SubTotal - DiscountAmount - PromotionAmount + TaxAmount
- **NetProfit** = TotalAmount - CampaignCost

---

## üìÅ Fichiers fournis

| Fichier                           | Description                                    | Dur√©e    |
| --------------------------------- | ---------------------------------------------- | -------- |
| `01_CREATE_DW_Structure.sql`      | ‚≠ê Cr√©ation compl√®te de la structure            | < 1 min  |
| `02A_LOAD_Dimensions.sql`         | ‚≠ê Chargement des 8 dimensions                  | 2-3 min  |
| `02B_LOAD_Facts_2022_2023.sql`    | ‚≠ê Chargement transactions 2022-2023            | 8-12 min |
| `02C_LOAD_Facts_2024.sql`         | ‚≠ê Chargement transactions 2024                 | 3-5 min  |
| `PURGE_DW_Complete.sql`           | üßπ Vider toutes les donn√©es (garder structure) | < 10 sec |
| `DROP_DW_Complete.sql`            | üóëÔ∏è Supprimer compl√®tement la base             | < 5 sec  |
| `VERIFY_Promotions_Campaigns.sql` | üìä V√©rifier promotions et campagnes            | < 5 sec  |
| `README.md`                       | Ce fichier - Guide utilisateur                 | -        |

---

## üöÄ Installation en 4 √©tapes

### Pr√©requis

- SQL Server 2019+ (Developer/Standard/Enterprise)
- SQL Server Management Studio (SSMS) 18+
- 5 GB espace disque libre
- Droits de cr√©ation de base de donn√©es

### √âtape 1Ô∏è‚É£ : Cr√©er la structure (< 1 minute)

```sql
-- Ouvrir SSMS
-- Ouvrir le fichier : 01_CREATE_DW_Structure.sql
-- Ex√©cuter (F5)
```

**R√©sultat attendu :**

```
‚úì Base de donn√©es DW cr√©√©e
‚úì Sch√©ma dw cr√©√©
‚úì 8 Dimensions cr√©√©es
‚úì 1 Table de faits cr√©√©e
‚òÖ‚òÖ‚òÖ DATA WAREHOUSE CR√â√â AVEC SUCC√àS ‚òÖ‚òÖ‚òÖ
```

### √âtape 2Ô∏è‚É£ : Charger les dimensions (2-3 minutes)

```sql
-- Ouvrir le fichier : 02A_LOAD_Dimensions.sql
-- Ex√©cuter (F5)
```

**R√©sultat attendu :**

```
1. DimDate      : 1096 dates (2022-2024)
2. DimTime      : 1440 heures
3. DimCustomer  : 500 clients
4. DimProduct   : 50 produits
5. DimStore     : 5 magasins
6. DimSalesPerson : 15 vendeurs
7. DimPromotion : 20 promotions
8. DimCampaign  : 12 campagnes
‚úì‚úì‚úì TOUTES LES DIMENSIONS CHARG√âES ‚úì‚úì‚úì
```

### √âtape 3Ô∏è‚É£ : Charger les faits 2022-2023 (8-12 minutes)

```sql
-- Ouvrir le fichier : 02B_LOAD_Facts_2022_2023.sql
-- Ex√©cuter (F5)
-- ‚è±Ô∏è PATIENCE : Ce script peut prendre 8-12 minutes
```

**R√©sultat attendu :**

```
G√©n√©ration ann√©e 2022...
  ‚úì ~27,000 lignes g√©n√©r√©es pour 2022
G√©n√©ration ann√©e 2023...
  ‚úì ~33,000 lignes g√©n√©r√©es pour 2023
‚úì ~60,000 lignes ins√©r√©es dans FactProductSales
‚úì‚úì‚úì CHARGEMENT 2022-2023 TERMIN√â ‚úì‚úì‚úì
```

### √âtape 4Ô∏è‚É£ : Charger les faits 2024 (3-5 minutes)

```sql
-- Ouvrir le fichier : 02C_LOAD_Facts_2024.sql
-- Ex√©cuter (F5)
```

**R√©sultat attendu :**

```
  ‚úì ~11,000 lignes g√©n√©r√©es pour 2024
‚úì ~11,000 lignes ins√©r√©es dans FactProductSales

STATISTIQUES COMPL√àTES 2022-2024
Ann√©e | Nb Lignes | CA TTC
2022  | ~27,000  | ~20M EUR
2023  | ~33,000  | ~26M EUR
2024  | ~11,000  | ~10M EUR

‚úì‚úì‚úì CHARGEMENT COMPLET TERMIN√â ‚úì‚úì‚úì
```

---

## ‚úÖ V√©rification post-installation

Ex√©cutez cette requ√™te pour valider :

```sql
USE DW;
GO

-- Comptage par dimension
SELECT 'DimDate' AS [Table], COUNT(*) AS [Lignes] FROM dw.DimDate
UNION ALL SELECT 'DimTime', COUNT(*) FROM dw.DimTime
UNION ALL SELECT 'DimCustomer', COUNT(*) FROM dw.DimCustomer
UNION ALL SELECT 'DimProduct', COUNT(*) FROM dw.DimProduct
UNION ALL SELECT 'DimStore', COUNT(*) FROM dw.DimStore
UNION ALL SELECT 'DimSalesPerson', COUNT(*) FROM dw.DimSalesPerson
UNION ALL SELECT 'DimPromotion', COUNT(*) FROM dw.DimPromotion
UNION ALL SELECT 'DimCampaign', COUNT(*) FROM dw.DimCampaign
UNION ALL SELECT 'FactProductSales', COUNT(*) FROM dw.FactProductSales;

-- V√©rification par ann√©e
SELECT 
    d.YearNumber AS [Ann√©e],
    COUNT(*) AS [Transactions],
    CAST(SUM(f.TotalAmount) AS DECIMAL(18,2)) AS [CA TTC (EUR)]
FROM dw.FactProductSales f
INNER JOIN dw.DimDate d ON f.DateSK = d.DateSK
GROUP BY d.YearNumber
ORDER BY d.YearNumber;
```

**R√©sultats attendus :**

| Table            | Lignes  |
| ---------------- | ------- |
| DimDate          | 1096    |
| DimTime          | 1440    |
| DimCustomer      | 500     |
| DimProduct       | 50      |
| DimStore         | 5       |
| DimSalesPerson   | 15      |
| DimPromotion     | 20      |
| DimCampaign      | 12      |
| FactProductSales | ~65,000 |

---

## üìä Donn√©es business

### R√©partition g√©ographique

| Pays         | Magasin               | Clients | % CA |
| ------------ | --------------------- | ------- | ---- |
| üáπüá≥ Tunisia | Tunis Centre Ville    | 200     | 15%  |
| üá´üá∑ France  | Paris Champs-√âlys√©es  | 150     | 35%  |
| üá©üá™ Germany | Berlin Alexanderplatz | 100     | 30%  |
| üá≤üá¶ Morocco | Casa Marina           | 50      | 10%  |
| üá´üá∑ France  | Lyon Part-Dieu        | 150     | 10%  |

### Catalogue produits

| Cat√©gorie   | Nombre | Prix moyen | Mix vente |
| ----------- | ------ | ---------- | --------- |
| Smartphones | 15     | 899‚Ç¨       | 40%       |
| Laptops     | 15     | 1699‚Ç¨      | 25%       |
| Tablets     | 10     | 799‚Ç¨       | 15%       |
| Accessories | 10     | 199‚Ç¨       | 20%       |

### Promotions majeures

- **Black Friday** : 25-30% (fin novembre chaque ann√©e)
- **Christmas** : 20-25% (mi-d√©cembre)
- **Summer Sale** : 15-20% (juillet-ao√ªt)
- **Back to School** : 12-15% (ao√ªt-septembre, laptops)

---

## üéì Cas d'usage p√©dagogiques

Ce Data Warehouse est id√©al pour enseigner :

### 1. Mod√©lisation dimensionnelle

- ‚úÖ Star schema (fait + dimensions)
- ‚úÖ SCD Type 1 et Type 2 (pr√™t)
- ‚úÖ Dimensions d√©g√©n√©r√©es
- ‚úÖ Cl√©s de substitution (SK) vs cl√©s m√©tier (BK)
- ‚úÖ Colonnes calcul√©es persist√©es

### 2. ETL / Int√©gration de donn√©es

- ‚úÖ Staging tables
- ‚úÖ Lookups de dimensions
- ‚úÖ Transformations de donn√©es
- ‚úÖ Gestion des valeurs par d√©faut
- ‚úÖ Validation et statistiques

### 3. Analyses BI

- ‚úÖ Time intelligence (YoY, MoM, running totals)
- ‚úÖ Analyses de promotions et campagnes
- ‚úÖ Segmentation clients (RFM)
- ‚úÖ Analyses produits (ABC, cross-sell)
- ‚úÖ M√©triques de performance vendeurs

### 4. Outils d√©cisionnels

- ‚úÖ Power BI : Dashboards interactifs
- ‚úÖ SSRS : Rapports pagin√©s
- ‚úÖ SSAS Tabular : Mod√®les s√©mantiques
- ‚úÖ Excel : Tableaux crois√©s dynamiques

---

## üìà Requ√™tes d'analyse exemples

### Croissance Year-over-Year

```sql
WITH YearlySales AS (
    SELECT 
        d.YearNumber,
        SUM(f.TotalAmount) AS CA
    FROM dw.FactProductSales f
    INNER JOIN dw.DimDate d ON f.DateSK = d.DateSK
    GROUP BY d.YearNumber
)
SELECT 
    YearNumber AS [Ann√©e],
    CAST(CA AS DECIMAL(18,2)) AS [CA],
    LAG(CA) OVER (ORDER BY YearNumber) AS [CA N-1],
    CAST(
        (CA - LAG(CA) OVER (ORDER BY YearNumber)) / 
        LAG(CA) OVER (ORDER BY YearNumber) * 100
        AS DECIMAL(5,2)
    ) AS [Croissance %]
FROM YearlySales
ORDER BY YearNumber;
```

### Top 10 produits par CA

```sql
SELECT TOP 10
    p.ProductName,
    p.Category,
    p.Brand,
    COUNT(*) AS [Ventes],
    CAST(SUM(f.TotalAmount) AS DECIMAL(18,2)) AS [CA Total]
FROM dw.FactProductSales f
INNER JOIN dw.DimProduct p ON f.ProductSK = p.ProductSK
GROUP BY p.ProductName, p.Category, p.Brand
ORDER BY SUM(f.TotalAmount) DESC;
```

### Impact des promotions

```sql
SELECT 
    p.PromotionName,
    p.PromotionType,
    COUNT(*) AS [Nb Ventes],
    CAST(SUM(f.SubTotal) AS DECIMAL(18,2)) AS [CA Brut],
    CAST(SUM(f.DiscountAmount) AS DECIMAL(18,2)) AS [Remises],
    CAST(SUM(f.PromotionAmount) AS DECIMAL(18,2)) AS [Co√ªt Promo],
    CAST(SUM(f.TotalAmount) AS DECIMAL(18,2)) AS [CA Net]
FROM dw.FactProductSales f
INNER JOIN dw.DimPromotion p ON f.PromotionSK = p.PromotionSK
WHERE p.PromotionSK > 0
GROUP BY p.PromotionName, p.PromotionType
ORDER BY SUM(f.TotalAmount) DESC;
```

### ROI des campagnes

```sql
SELECT 
    c.CampaignName,
    c.CampaignType,
    c.BudgetAmount AS [Budget],
    COUNT(*) AS [Ventes G√©n√©r√©es],
    CAST(SUM(f.TotalAmount) AS DECIMAL(18,2)) AS [CA G√©n√©r√©],
    CAST(
        (SUM(f.TotalAmount) - c.BudgetAmount) / 
        c.BudgetAmount * 100 
        AS DECIMAL(10,2)
    ) AS [ROI %]
FROM dw.FactProductSales f
INNER JOIN dw.DimCampaign c ON f.CampaignSK = c.CampaignSK
WHERE c.CampaignSK > 0
GROUP BY c.CampaignName, c.CampaignType, c.BudgetAmount
ORDER BY [ROI %] DESC;
```

---

## üîß Maintenance et nettoyage

### Option 1 : Vider les donn√©es (garder la structure) üßπ

**Script** : `PURGE_DW_Complete.sql`

Utilise ce script quand tu veux :

- Recommencer le chargement avec des donn√©es corrig√©es
- Nettoyer des donn√©es de test
- Conserver la structure mais vider les tables

```sql
-- Ex√©cuter : PURGE_DW_Complete.sql
-- Dur√©e : < 10 secondes
```

**Ce qu'il fait :**

1. ‚úÖ Vide toutes les tables (TRUNCATE)
2. ‚úÖ R√©initialise les compteurs IDENTITY
3. ‚úÖ Conserve les valeurs par d√©faut (Promotion -1, Campaign -1)
4. ‚úÖ Garde toute la structure (tables, index, FK)

**Apr√®s la purge :**

```sql
-- Recharger directement les dimensions et faits
-- 1. Ex√©cuter : 02A_LOAD_Dimensions.sql
-- 2. Ex√©cuter : 02B_LOAD_Facts_2022_2023.sql
-- 3. Ex√©cuter : 02C_LOAD_Facts_2024.sql
```

---

### Option 2 : Supprimer compl√®tement la base üóëÔ∏è

**Script** : `DROP_DW_Complete.sql`

Utilise ce script quand tu veux :

- Recommencer COMPL√àTEMENT from scratch
- Tester une nouvelle structure
- Nettoyer compl√®tement l'environnement

```sql
-- Ex√©cuter : DROP_DW_Complete.sql
-- Dur√©e : < 5 secondes
```

**Ce qu'il fait :**

1. ‚úÖ Ferme toutes les connexions
2. ‚úÖ Supprime la base DW compl√®tement
3. ‚úÖ Lib√®re tout l'espace disque

**Apr√®s la suppression :**

```sql
-- Recr√©er tout from scratch
-- 1. Ex√©cuter : 01_CREATE_DW_Structure.sql
-- 2. Ex√©cuter : 02A_LOAD_Dimensions.sql
-- 3. Ex√©cuter : 02B_LOAD_Facts_2022_2023.sql
-- 4. Ex√©cuter : 02C_LOAD_Facts_2024.sql
```

---

### Quelle option choisir ?

| Situation                                      | Script √† utiliser       |
| ---------------------------------------------- | ----------------------- |
| ‚ùå Donn√©es incorrectes (bug dans le script)     | `PURGE_DW_Complete.sql` |
| ‚ùå Erreur pendant le chargement                 | `PURGE_DW_Complete.sql` |
| üîÑ Tester des corrections dans les scripts ETL | `PURGE_DW_Complete.sql` |
| üÜï Modifier la structure des tables            | `DROP_DW_Complete.sql`  |
| üÜï Ajouter/supprimer des colonnes              | `DROP_DW_Complete.sql`  |
| üß™ Environnement de test √† nettoyer            | `DROP_DW_Complete.sql`  |

---

### Script de v√©rification üìä

**Script** : `VERIFY_Promotions_Campaigns.sql`

Utilise ce script pour :

- V√©rifier la r√©partition des promotions et campagnes
- Valider que les PromotionSK et CampaignSK varient correctement
- Voir les statistiques par promotion/campagne
- Calculer le ROI des campagnes

```sql
-- Ex√©cuter : VERIFY_Promotions_Campaigns.sql
-- Dur√©e : < 5 secondes
```

**R√©sultats affich√©s :**

- R√©partition des promotions (avec/sans)
- R√©partition des campagnes par p√©riode
- TOP 5 promotions par CA
- TOP 5 campagnes par ROI
- Statistiques par ann√©e

---

## üÜò D√©pannage

### Probl√®me : "Le sch√©ma dw n'existe pas"

**Solution :** Ex√©cutez `01_CREATE_DW_Structure.sql` en premier.

### Probl√®me : "Erreur FK lors de l'insertion"

**Solution :** V√©rifiez que `02A_LOAD_Dimensions.sql` s'est ex√©cut√© compl√®tement.

### Probl√®me : Le chargement prend trop de temps

**Normal :** 02B et 02C peuvent prendre 10-15 minutes au total.
