

## SSMS – Créer la base et la sécuriser

### A1) Créer la base

1. Ouvrir SSMS → se connecter à **DESKTOP-463V422\SERVER2024**

2. New Query → exécuter :

```sql
CREATE DATABASE DWIrregularDim;
GO
```

### A2) Créer les schémas dw et abc

New Query → exécuter :

```sql
USE DWIrregularDim;
GO

CREATE SCHEMA dw;
GO

CREATE SCHEMA abc;
GO
```

### A3) Créer le login SQL bechir + user base + rôles

New Query → exécuter :

```sql
USE master;
GO

IF NOT EXISTS (SELECT 1 FROM sys.sql_logins WHERE name = 'bechir')
BEGIN
    CREATE LOGIN bechir
    WITH PASSWORD = 'test',
         CHECK_POLICY = OFF,
         CHECK_EXPIRATION = OFF;
END
GO

USE DWIrregularDim;
GO

IF NOT EXISTS (SELECT 1 FROM sys.database_principals WHERE name = 'bechir')
BEGIN
    CREATE USER bechir FOR LOGIN bechir;
END
GO

ALTER ROLE db_datareader ADD MEMBER bechir;
ALTER ROLE db_datawriter ADD MEMBER bechir;
GO
```

### A4) Donner les droits au compte service SSAS (indispensable)

New Query → exécuter :

```sql
USE DWIrregularDim;
GO

IF NOT EXISTS (SELECT 1 FROM sys.database_principals WHERE name = 'NT Service\MSOLAP$SERVER2024')
BEGIN
    CREATE USER [NT Service\MSOLAP$SERVER2024] FOR LOGIN [NT Service\MSOLAP$SERVER2024];
END
GO

ALTER ROLE db_datareader ADD MEMBER [NT Service\MSOLAP$SERVER2024];
GO
```

---

## B. SSMS – Créer les tables et injecter des données (schéma dw)

### B1) Créer DimProduct et FactSales + données

New Query → exécuter :

```sql
USE DWIrregularDim;
GO

IF OBJECT_ID('dw.FactSales') IS NOT NULL DROP TABLE dw.FactSales;
IF OBJECT_ID('dw.DimProduct') IS NOT NULL DROP TABLE dw.DimProduct;
GO

CREATE TABLE dw.DimProduct
(
    ProductSK   INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    ProductBK   INT NOT NULL,
    Category    NVARCHAR(50) NOT NULL,
    SubCategory NVARCHAR(50) NULL,
    ProductName NVARCHAR(100) NOT NULL
);
GO

CREATE TABLE dw.FactSales
(
    ProductSK   INT NOT NULL,
    Quantity    INT NOT NULL,
    SalesAmount DECIMAL(18,2) NOT NULL,
    CONSTRAINT FK_FactSales_DimProduct
        FOREIGN KEY (ProductSK) REFERENCES dw.DimProduct(ProductSK)
);
GO

INSERT INTO dw.DimProduct (ProductBK, Category, SubCategory, ProductName)
VALUES
(1001, 'Laptop',      'Gaming',    'Acer Swift X'),
(1002, 'Laptop',      'Ultrabook',  'Dell XPS 13'),
(2001, 'Accessoires', NULL,        'Mouse Logitech'),
(2002, 'Accessoires', NULL,        'Keyboard MX');
GO

INSERT INTO dw.FactSales (ProductSK, Quantity, SalesAmount)
SELECT ProductSK, 10, 12000.00 FROM dw.DimProduct WHERE ProductName = 'Acer Swift X'
UNION ALL
SELECT ProductSK,  5,  9000.00 FROM dw.DimProduct WHERE ProductName = 'Dell XPS 13'
UNION ALL
SELECT ProductSK, 25,   750.00 FROM dw.DimProduct WHERE ProductName = 'Mouse Logitech'
UNION ALL
SELECT ProductSK, 15,  1200.00 FROM dw.DimProduct WHERE ProductName = 'Keyboard MX';
GO
```

### B2) Vérifier que les tables existent (dans dw)

New Query → exécuter :

```sql
USE DWIrregularDim;
GO

SELECT s.name AS SchemaName, t.name AS TableName
FROM sys.tables t
JOIN sys.schemas s ON s.schema_id = t.schema_id
ORDER BY s.name, t.name;
GO
```

Tu dois voir :

- dw.DimProduct

- dw.FactSales

---

## C. SSDT – Préparer l’environnement SSAS

### C1) Créer le projet SSAS Multidimensional

1. Visual Studio / SSDT

2. New Project

3. Analysis Services Multidimensional and Data Mining Project

4. Nom : DWIrregularDimCube

### C2) Créer la Data Source

1. Solution Explorer → Data Sources → New Data Source

2. New…

3. Server : **DESKTOP-463V422\SERVER2024**

4. Database : **DWIrregularDim**

5. Authentification : SQL Server Authentication

6. User : **bechir**

7. Password : **test**

8. Next → Finish

### C3) Impersonation (point critique)

1. Double-clic sur la Data Source

2. Onglet Impersonation Information

3. Choisir : Use the service account

4. OK / Save

### C4) Créer la Data Source View

1. Data Source Views → New Data Source View

2. Sélectionner la Data Source créée

3. La liste doit afficher :
   
   - dw.DimProduct
   
   - dw.FactSales

4. Ajouter les deux → Next → Finish

---

## D. Si la liste est vide dans la DSV (procédure courte)

1. Retour SSMS → exécuter :

```sql
USE DWIrregularDim;
GO
SELECT TOP (1) * FROM dw.DimProduct;
GO
```

2. Si OK → SSDT

3. Revenir dans la Data Source → Test Connection

4. Recréer la DSV

---

Quand tu arrives à l’étape C4 et que tu vois bien les 2 tables, dis-le et je te donne la suite immédiate :

- création dimension produit

- hiérarchie Category → SubCategory → ProductName

- réglage irrégulière (Ragged + HideMemberIf)

- création measure group FactSales et test navigateur cube
